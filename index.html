<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Absensi SMAN 5 Taruna Brawijaya</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full fade-in">
            <!-- School Logo -->
            <div class="text-center mb-8">
                <div class="flex justify-center mb-4" id="loginLogo">
                    <svg width="100" height="100" viewBox="0 0 100 100" class="drop-shadow-lg">
                        <circle cx="50" cy="50" r="48" fill="#DC2626" stroke="#1F2937" stroke-width="2"/>
                        <circle cx="50" cy="50" r="42" fill="#FFFFFF"/>
                        <path d="M25 45 Q35 35 50 45 Q65 35 75 45 Q65 55 50 50 Q35 55 25 45" fill="#B91C1C"/>
                        <circle cx="50" cy="50" r="15" fill="#1E40AF" stroke="#FFFFFF" stroke-width="2"/>
                        <path d="M50 40 L52 46 L58 46 L53 50 L55 56 L50 52 L45 56 L47 50 L42 46 L48 46 Z" fill="#FBBF24"/>
                        <text x="50" y="75" text-anchor="middle" class="fill-blue-800 font-bold text-xs">SMAN 5</text>
                        <text x="50" y="85" text-anchor="middle" class="fill-blue-800 font-semibold text-xs">TARUNA</text>
                        <circle cx="30" cy="30" r="3" fill="#FBBF24"/>
                        <circle cx="70" cy="30" r="3" fill="#FBBF24"/>
                        <circle cx="30" cy="70" r="3" fill="#FBBF24"/>
                        <circle cx="70" cy="70" r="3" fill="#FBBF24"/>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Sistem Absensi Digital</h1>
                <p class="text-gray-600">SMAN 5 Taruna Brawijaya Jawa Timur</p>
            </div>

            <!-- Login Form -->
            <form onsubmit="handleLogin(event)" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üë§ Username</label>
                    <input type="text" id="username" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                           placeholder="Masukkan username Anda">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üîí Password</label>
                    <input type="password" id="password" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                           placeholder="Masukkan password Anda">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üé≠ Login Sebagai</label>
                    <select id="userRole" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="admin">üîß Administrator</option>
                        <option value="teacher">üë®‚Äçüè´ Guru/Staff</option>
                    </select>
                </div>

                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                    üöÄ Masuk ke Sistem
                </button>
            </form>

            <!-- Demo Accounts -->
            <div class="mt-8 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                <h4 class="font-medium text-yellow-800 mb-3">üéØ Akun Demo untuk Testing:</h4>
                <div class="text-sm text-yellow-700 space-y-2">
                    <div class="flex justify-between items-center">
                        <span><strong>Admin:</strong> admin / admin123</span>
                        <button onclick="quickLogin('admin', 'admin123', 'admin')" 
                                class="px-2 py-1 bg-yellow-500 text-white rounded text-xs hover:bg-yellow-600">
                            Login
                        </button>
                    </div>
                    <div class="flex justify-between items-center">
                        <span><strong>Guru:</strong> guru / guru123</span>
                        <button onclick="quickLogin('guru', 'guru123', 'teacher')" 
                                class="px-2 py-1 bg-yellow-500 text-white rounded text-xs hover:bg-yellow-600">
                            Login
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden min-h-screen">
        <!-- Admin Header -->
        <div class="bg-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div id="adminLogo"></div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">üîß Dashboard Administrator</h1>
                            <p class="text-gray-600">Panel Kontrol Sistem Absensi</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <div class="text-sm text-gray-500">Selamat datang,</div>
                            <div class="font-semibold text-gray-800" id="adminUsername">Administrator</div>
                        </div>
                        <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            üö™ Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Content -->
        <div class="container mx-auto px-4 py-8">
            <!-- Admin Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">Total Kelas</p>
                            <p class="text-3xl font-bold text-gray-800" id="totalClasses">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">üìö</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">Total Guru</p>
                            <p class="text-3xl font-bold text-gray-800" id="totalTeachers">0</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">üë®‚Äçüè´</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-600 text-sm font-medium">Total Siswa</p>
                            <p class="text-3xl font-bold text-gray-800" id="totalStudents">0</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">üë•</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-orange-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-600 text-sm font-medium">Absensi Hari Ini</p>
                            <p class="text-3xl font-bold text-gray-800" id="todayAttendance">0</p>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">üìä</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Menu -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminSection('users')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">üë•</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Kelola Pengguna</h3>
                            <p class="text-gray-600 text-sm">Tambah, edit, hapus akun guru dan admin</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminSection('classes')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">üìö</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Kelola Kelas</h3>
                            <p class="text-gray-600 text-sm">Atur kelas, mata pelajaran, jadwal</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminSection('students')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">üéì</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Kelola Siswa</h3>
                            <p class="text-gray-600 text-sm">Import, edit data siswa per kelas</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminSection('reports')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">üìä</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Laporan Absensi</h3>
                            <p class="text-gray-600 text-sm">Lihat dan export laporan kehadiran</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminSection('settings')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">‚öôÔ∏è</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Pengaturan Sistem</h3>
                            <p class="text-gray-600 text-sm">Konfigurasi logo, backup, restore</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminSection('logs')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">üìã</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Log Aktivitas</h3>
                            <p class="text-gray-600 text-sm">Monitor aktivitas pengguna sistem</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Sections (Hidden by default) -->
            <div id="adminSections" class="hidden">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Teacher Dashboard -->
    <div id="teacherDashboard" class="hidden min-h-screen">
        <!-- Teacher Header -->
        <div class="bg-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div id="teacherLogo"></div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">üë®‚Äçüè´ Dashboard Guru</h1>
                            <p class="text-gray-600">Sistem Pencatatan Kehadiran Siswa</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <div class="text-sm text-gray-500">Selamat datang,</div>
                            <div class="font-semibold text-gray-800" id="teacherUsername">Guru</div>
                        </div>
                        <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            üö™ Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Content -->
        <div class="container mx-auto px-4 py-8">
            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showTeacherSection('attendance')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">‚úÖ</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Absensi Siswa</h3>
                            <p class="text-gray-600 text-sm">Catat kehadiran siswa hari ini</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showTeacherSection('history')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">üìö</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Riwayat Absensi</h3>
                            <p class="text-gray-600 text-sm">Lihat riwayat absensi yang telah dibuat</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showTeacherSection('download')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">üì•</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Download Hasil</h3>
                            <p class="text-gray-600 text-sm">Export laporan absensi ke Excel/PDF</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showTeacherSection('journal')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">üìñ</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Jurnal Mengajar</h3>
                            <p class="text-gray-600 text-sm">Catat tema pembelajaran dan pertemuan</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showTeacherSection('profile')">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center">
                            <span class="text-3xl">üë§</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Profil Saya</h3>
                            <p class="text-gray-600 text-sm">Edit profil dan ganti password</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teacher Sections -->
            <div id="teacherSections">
                <!-- Default: Show attendance form -->
                <div id="attendanceSection" class="fade-in">
                    <!-- Class Info -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                <select id="teacherClassSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="XII IPA 1">XII IPA 1</option>
                                    <option value="XII IPA 2">XII IPA 2</option>
                                    <option value="XI IPA 1">XI IPA 1</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                                <select id="teacherSubjectSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="Matematika">Matematika</option>
                                    <option value="Fisika">Fisika</option>
                                    <option value="Kimia">Kimia</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Jam Pelajaran</label>
                                <select id="teacherTimeSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="07:00 - 07:45">07:00 - 07:45</option>
                                    <option value="07:45 - 08:30">07:45 - 08:30</option>
                                    <option value="08:30 - 09:15">08:30 - 09:15</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Student List for Attendance -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-semibold text-gray-800">Daftar Kehadiran Siswa</h2>
                            <div class="text-sm text-gray-500" id="teacherCurrentDate"></div>
                        </div>

                        <!-- Summary Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <div class="text-green-600 text-sm font-medium">Hadir</div>
                                <div class="text-2xl font-bold text-green-700" id="teacherPresentCount">0</div>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                <div class="text-yellow-600 text-sm font-medium">Izin</div>
                                <div class="text-2xl font-bold text-yellow-700" id="teacherExcusedCount">0</div>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <div class="text-red-600 text-sm font-medium">Sakit</div>
                                <div class="text-2xl font-bold text-red-700" id="teacherSickCount">0</div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <div class="text-gray-600 text-sm font-medium">Alpha</div>
                                <div class="text-2xl font-bold text-gray-700" id="teacherAbsentCount">0</div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                <div class="text-purple-600 text-sm font-medium">Dispensasi</div>
                                <div class="text-2xl font-bold text-purple-700" id="teacherDispensasiCount">0</div>
                            </div>
                        </div>

                        <!-- Student List -->
                        <div class="space-y-3" id="teacherStudentList">
                            <!-- Students will be populated by JavaScript -->
                        </div>

                        <!-- Action Buttons -->
                        <div class="mt-8 flex gap-4 justify-center">
                            <button onclick="teacherMarkAllPresent()" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium">
                                ‚úì Semua Hadir
                            </button>
                            <button onclick="teacherSaveAttendance()" class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                üíæ Simpan Absensi
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // System data
        let currentUser = null;
        let currentRole = null;

        // Demo accounts
        const accounts = {
            admin: { username: 'admin', password: 'admin123', role: 'admin', name: 'Administrator' },
            guru: { username: 'guru', password: 'guru123', role: 'teacher', name: 'Bapak/Ibu Guru' }
        };

        // Sample data
        let classes = ["XII IPA 1", "XII IPA 2", "XII IPS 1", "XI IPA 1", "XI IPS 1", "X MIPA 1", "X MIPA 2"];
        let subjects = ["Matematika", "Bahasa Indonesia", "Bahasa Inggris", "Fisika", "Kimia", "Biologi", "Sejarah", "Geografi"];
        let timePeriods = ["07:00 - 07:45", "07:45 - 08:30", "08:30 - 09:15", "09:30 - 10:15", "10:15 - 11:00"];

        // Sample students
        const students = [
            { id: 1, name: "Ahmad Rizki Pratama", nis: "2023001", class: "XII IPA 1" },
            { id: 2, name: "Siti Nurhaliza", nis: "2023002", class: "XII IPA 1" },
            { id: 3, name: "Budi Santoso", nis: "2023003", class: "XII IPA 1" },
            { id: 4, name: "Dewi Sartika", nis: "2023004", class: "XII IPA 1" },
            { id: 5, name: "Eko Prasetyo", nis: "2023005", class: "XII IPA 1" },
            { id: 6, name: "Fitri Handayani", nis: "2023006", class: "XII IPA 1" },
            { id: 7, name: "Gilang Ramadhan", nis: "2023007", class: "XII IPA 1" },
            { id: 8, name: "Hana Pertiwi", nis: "2023008", class: "XII IPA 1" },
            { id: 9, name: "Indra Gunawan", nis: "2023009", class: "XII IPA 1" },
            { id: 10, name: "Joko Widodo", nis: "2023010", class: "XII IPA 1" },
            { id: 11, name: "Kartika Sari", nis: "2023011", class: "XII IPA 1" },
            { id: 12, name: "Lukman Hakim", nis: "2023012", class: "XII IPA 1" }
        ];

        let teacherAttendance = {};
        let teacherStudentNotes = {};

        // Initialize attendance data
        students.forEach(student => {
            teacherAttendance[student.id] = 'present';
            teacherStudentNotes[student.id] = '';
        });

        // Logo configuration
        let currentLogoConfig = {
            schoolName1: 'SMAN 5',
            schoolName2: 'TARUNA',
            primaryColor: '#DC2626',
            secondaryColor: '#1E40AF',
            logoStyle: 'garuda',
            logoSize: '80',
            customImage: null
        };

        // Generate logo SVG
        function generateLogoSVG(config, size = null) {
            const logoSize = size || parseInt(config.logoSize);
            const viewBox = `0 0 100 100`;
            
            if (config.customImage) {
                return `<img src="${config.customImage}" width="${logoSize}" height="${logoSize}" class="drop-shadow-lg rounded-lg" alt="Custom Logo">`;
            }
            
            let logoContent = `
                <circle cx="50" cy="50" r="48" fill="${config.primaryColor}" stroke="#1F2937" stroke-width="2"/>
                <circle cx="50" cy="50" r="42" fill="#FFFFFF"/>
                <path d="M25 45 Q35 35 50 45 Q65 35 75 45 Q65 55 50 50 Q35 55 25 45" fill="${config.primaryColor}"/>
                <circle cx="50" cy="50" r="15" fill="${config.secondaryColor}" stroke="#FFFFFF" stroke-width="2"/>
                <path d="M50 40 L52 46 L58 46 L53 50 L55 56 L50 52 L45 56 L47 50 L42 46 L48 46 Z" fill="#FBBF24"/>
                <circle cx="30" cy="30" r="3" fill="#FBBF24"/>
                <circle cx="70" cy="30" r="3" fill="#FBBF24"/>
                <circle cx="30" cy="70" r="3" fill="#FBBF24"/>
                <circle cx="70" cy="70" r="3" fill="#FBBF24"/>
                <text x="50" y="75" text-anchor="middle" class="fill-blue-800 font-bold text-xs">${config.schoolName1}</text>
                <text x="50" y="85" text-anchor="middle" class="fill-blue-800 font-semibold text-xs">${config.schoolName2}</text>
            `;
            
            return `
                <svg width="${logoSize}" height="${logoSize}" viewBox="${viewBox}" class="drop-shadow-lg">
                    ${logoContent}
                </svg>
            `;
        }

        // Quick login function
        function quickLogin(username, password, role) {
            document.getElementById('username').value = username;
            document.getElementById('password').value = password;
            document.getElementById('userRole').value = role;
            
            // Trigger login
            const event = new Event('submit');
            document.querySelector('form').dispatchEvent(event);
        }

        // Handle login
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('userRole').value;
            
            // Check credentials
            let validLogin = false;
            let userAccount = null;
            
            for (let key in accounts) {
                const account = accounts[key];
                if (account.username === username && account.password === password && account.role === role) {
                    validLogin = true;
                    userAccount = account;
                    break;
                }
            }
            
            if (validLogin) {
                currentUser = userAccount;
                currentRole = role;
                
                // Hide login screen
                document.getElementById('loginScreen').classList.add('hidden');
                
                // Show appropriate dashboard
                if (role === 'admin') {
                    showAdminDashboard();
                } else if (role === 'teacher') {
                    showTeacherDashboard();
                }
                
                // Log activity
                logActivity(`${userAccount.name} login sebagai ${role}`);
                
            } else {
                alert('‚ùå Login Gagal!\n\nUsername, password, atau role tidak sesuai.\n\nSilakan coba lagi atau gunakan akun demo yang tersedia.');
            }
        }

        // Show admin dashboard
        function showAdminDashboard() {
            document.getElementById('adminDashboard').classList.remove('hidden');
            document.getElementById('adminUsername').textContent = currentUser.name;
            
            // Update logo
            document.getElementById('adminLogo').innerHTML = generateLogoSVG(currentLogoConfig, 60);
            
            // Update stats
            updateAdminStats();
        }

        // Show teacher dashboard
        function showTeacherDashboard() {
            document.getElementById('teacherDashboard').classList.remove('hidden');
            document.getElementById('teacherUsername').textContent = currentUser.name;
            
            // Update logo
            document.getElementById('teacherLogo').innerHTML = generateLogoSVG(currentLogoConfig, 60);
            
            // Set current date
            setTeacherCurrentDate();
            
            // Render student list
            renderTeacherStudentList();
        }

        // Update admin stats
        function updateAdminStats() {
            document.getElementById('totalClasses').textContent = classes.length;
            document.getElementById('totalTeachers').textContent = Object.keys(accounts).filter(key => accounts[key].role === 'teacher').length;
            document.getElementById('totalStudents').textContent = students.length;
            
            // Get today's attendance count from localStorage
            const today = new Date().toLocaleDateString('id-ID');
            let todayCount = 0;
            try {
                const allRecords = localStorage.getItem('all_attendance_records');
                if (allRecords) {
                    const records = JSON.parse(allRecords);
                    todayCount = records.filter(record => record.date === today).length;
                }
            } catch (e) {
                todayCount = 0;
            }
            document.getElementById('todayAttendance').textContent = todayCount;
        }

        // Set teacher current date
        function setTeacherCurrentDate() {
            const selectedDate = document.getElementById('teacherAttendanceDate')?.value;
            if (selectedDate) {
                const date = new Date(selectedDate + 'T00:00:00');
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                document.getElementById('teacherCurrentDate').textContent = date.toLocaleDateString('id-ID', options);
            } else {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                document.getElementById('teacherCurrentDate').textContent = now.toLocaleDateString('id-ID', options);
            }
        }

        // Update attendance date and show appropriate warnings
        function updateAttendanceDate() {
            const selectedDate = document.getElementById('teacherAttendanceDate').value;
            const today = new Date().toISOString().split('T')[0];
            
            // Hide all alerts first
            document.getElementById('dateInfoAlert').classList.add('hidden');
            document.getElementById('pastDateWarning').classList.add('hidden');
            document.getElementById('futureDateWarning').classList.add('hidden');
            
            if (selectedDate) {
                const selected = new Date(selectedDate + 'T00:00:00');
                const todayDate = new Date(today + 'T00:00:00');
                
                // Update the current date display
                setTeacherCurrentDate();
                
                if (selectedDate === today) {
                    // Today - show info
                    document.getElementById('dateInfoAlert').classList.remove('hidden');
                    document.getElementById('dateInfoText').textContent = 'Anda sedang mengisi absensi untuk hari ini.';
                } else if (selectedDate < today) {
                    // Past date - show warning
                    document.getElementById('pastDateWarning').classList.remove('hidden');
                    
                    // Calculate days difference
                    const diffTime = todayDate - selected;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    document.getElementById('dateInfoAlert').classList.remove('hidden');
                    document.getElementById('dateInfoText').textContent = `Mengisi absensi untuk ${diffDays} hari yang lalu (${selected.toLocaleDateString('id-ID')}).`;
                } else {
                    // Future date - show error
                    document.getElementById('futureDateWarning').classList.remove('hidden');
                    
                    const diffTime = selected - todayDate;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    document.getElementById('dateInfoAlert').classList.remove('hidden');
                    document.getElementById('dateInfoText').textContent = `Tanggal yang dipilih adalah ${diffDays} hari ke depan.`;
                }
                
                // Check if attendance already exists for this date
                checkExistingAttendance();
            }
        }

        // Set quick date
        function setQuickDate(daysOffset) {
            const date = new Date();
            date.setDate(date.getDate() + daysOffset);
            const dateString = date.toISOString().split('T')[0];
            
            document.getElementById('teacherAttendanceDate').value = dateString;
            updateAttendanceDate();
        }

        // Show date picker (focus on date input)
        function showDatePicker() {
            document.getElementById('teacherAttendanceDate').focus();
            document.getElementById('teacherAttendanceDate').showPicker?.();
        }

        // Check if attendance already exists for selected date
        function checkExistingAttendance() {
            try {
                const selectedDate = document.getElementById('teacherAttendanceDate').value;
                const selectedClass = document.getElementById('teacherClassSelect').value;
                const selectedSubject = document.getElementById('teacherSubjectSelect').value;
                const selectedTime = document.getElementById('teacherTimeSelect').value;
                
                if (!selectedDate) return;
                
                const allRecords = localStorage.getItem('all_attendance_records');
                if (allRecords) {
                    const records = JSON.parse(allRecords);
                    const formattedDate = new Date(selectedDate + 'T00:00:00').toLocaleDateString('id-ID');
                    
                    const existingRecord = records.find(record => 
                        record.date === formattedDate &&
                        record.class === selectedClass &&
                        record.subject === selectedSubject &&
                        record.time === selectedTime &&
                        record.savedBy === currentUser.name
                    );
                    
                    if (existingRecord) {
                        // Show existing attendance warning
                        const existingAlert = document.getElementById('existingAttendanceAlert');
                        if (existingAlert) {
                            existingAlert.remove();
                        }
                        
                        const alertHTML = `
                            <div id="existingAttendanceAlert" class="mt-4 p-4 bg-orange-50 border border-orange-200 rounded-lg">
                                <div class="flex items-start space-x-3">
                                    <span class="text-orange-600 text-lg">üìã</span>
                                    <div class="flex-1">
                                        <div class="text-orange-800 font-medium mb-2">Absensi Sudah Ada!</div>
                                        <div class="text-orange-700 text-sm mb-3">
                                            Anda sudah pernah membuat absensi untuk:
                                            <br>‚Ä¢ <strong>Tanggal:</strong> ${formattedDate}
                                            <br>‚Ä¢ <strong>Kelas:</strong> ${selectedClass}
                                            <br>‚Ä¢ <strong>Mata Pelajaran:</strong> ${selectedSubject}
                                            <br>‚Ä¢ <strong>Jam:</strong> ${selectedTime}
                                        </div>
                                        <div class="flex space-x-2">
                                            <button onclick="loadExistingAttendance('${existingRecord.saveKey}')" 
                                                    class="px-3 py-1 bg-orange-500 text-white rounded text-sm hover:bg-orange-600">
                                                üìù Edit Absensi Lama
                                            </button>
                                            <button onclick="viewAttendanceDetail('${existingRecord.saveKey}')" 
                                                    class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">
                                                üëÅÔ∏è Lihat Detail
                                            </button>
                                            <button onclick="document.getElementById('existingAttendanceAlert').remove()" 
                                                    class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">
                                                ‚úï Tutup
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        document.querySelector('.bg-white.rounded-xl.shadow-lg.p-6.mb-8').insertAdjacentHTML('afterend', alertHTML);
                    }
                }
            } catch (e) {
                console.error('Error checking existing attendance:', e);
            }
        }

        // Render teacher student list
        function renderTeacherStudentList() {
            const studentList = document.getElementById('teacherStudentList');
            studentList.innerHTML = '';

            const selectedClass = document.getElementById('teacherClassSelect').value;
            const classStudents = students.filter(student => student.class === selectedClass);

            classStudents.forEach(student => {
                const studentDiv = document.createElement('div');
                studentDiv.className = 'bg-gray-50 p-4 rounded-lg border border-gray-200';
                
                const studentNote = teacherStudentNotes[student.id] || '';
                
                studentDiv.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center">
                                    <span class="text-indigo-600 font-semibold">${student.name.charAt(0)}</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-800">${student.name}</div>
                                    <div class="text-sm text-gray-500">NIS: ${student.nis}</div>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="setTeacherAttendance(${student.id}, 'present')" 
                                        class="px-3 py-1 rounded-full text-sm font-medium transition-colors ${teacherAttendance[student.id] === 'present' ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-green-100'}">
                                    Hadir
                                </button>
                                <button onclick="setTeacherAttendance(${student.id}, 'excused')" 
                                        class="px-3 py-1 rounded-full text-sm font-medium transition-colors ${teacherAttendance[student.id] === 'excused' ? 'bg-yellow-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-yellow-100'}">
                                    Izin
                                </button>
                                <button onclick="setTeacherAttendance(${student.id}, 'sick')" 
                                        class="px-3 py-1 rounded-full text-sm font-medium transition-colors ${teacherAttendance[student.id] === 'sick' ? 'bg-orange-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-orange-100'}">
                                    Sakit
                                </button>
                                <button onclick="setTeacherAttendance(${student.id}, 'absent')" 
                                        class="px-3 py-1 rounded-full text-sm font-medium transition-colors ${teacherAttendance[student.id] === 'absent' ? 'bg-red-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-red-100'}">
                                    Alpha
                                </button>
                                <button onclick="setTeacherAttendance(${student.id}, 'dispensasi')" 
                                        class="px-3 py-1 rounded-full text-sm font-medium transition-colors ${teacherAttendance[student.id] === 'dispensasi' ? 'bg-purple-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-purple-100'}">
                                    Dispensasi
                                </button>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <label class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0">üìù Keterangan:</label>
                            <input 
                                type="text" 
                                placeholder="Tambahkan keterangan (opsional)..." 
                                value="${studentNote}"
                                onchange="updateTeacherStudentNote(${student.id}, this.value)"
                                class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white"
                            />
                        </div>
                    </div>
                `;
                
                studentList.appendChild(studentDiv);
            });
            
            updateTeacherStats();
        }

        // Set teacher attendance
        function setTeacherAttendance(studentId, status) {
            teacherAttendance[studentId] = status;
            renderTeacherStudentList();
        }

        // Update teacher student note
        function updateTeacherStudentNote(studentId, note) {
            teacherStudentNotes[studentId] = note.trim();
        }

        // Mark all students as present (teacher)
        function teacherMarkAllPresent() {
            const selectedClass = document.getElementById('teacherClassSelect').value;
            const classStudents = students.filter(student => student.class === selectedClass);
            
            classStudents.forEach(student => {
                teacherAttendance[student.id] = 'present';
            });
            renderTeacherStudentList();
        }

        // Update teacher stats
        function updateTeacherStats() {
            const selectedClass = document.getElementById('teacherClassSelect').value;
            const classStudents = students.filter(student => student.class === selectedClass);
            
            const stats = {
                present: 0,
                excused: 0,
                sick: 0,
                absent: 0,
                dispensasi: 0
            };

            classStudents.forEach(student => {
                const status = teacherAttendance[student.id];
                if (stats.hasOwnProperty(status)) {
                    stats[status]++;
                }
            });

            document.getElementById('teacherPresentCount').textContent = stats.present;
            document.getElementById('teacherExcusedCount').textContent = stats.excused;
            document.getElementById('teacherSickCount').textContent = stats.sick;
            document.getElementById('teacherAbsentCount').textContent = stats.absent;
            document.getElementById('teacherDispensasiCount').textContent = stats.dispensasi;
        }

        // Load existing attendance for editing
        function loadExistingAttendance(saveKey) {
            try {
                const attendanceData = localStorage.getItem(saveKey);
                if (!attendanceData) {
                    alert('‚ùå Data absensi tidak ditemukan!');
                    return;
                }
                
                const fullRecord = JSON.parse(attendanceData);
                
                // Load attendance data into current form
                teacherAttendance = { ...fullRecord.attendance };
                teacherStudentNotes = { ...fullRecord.studentNotes };
                
                // Update form fields to match the existing record
                document.getElementById('teacherClassSelect').value = fullRecord.class;
                document.getElementById('teacherSubjectSelect').value = fullRecord.subject;
                document.getElementById('teacherTimeSelect').value = fullRecord.time;
                
                // Convert date back to input format
                const dateParts = fullRecord.date.split('/');
                const isoDate = `${dateParts[2]}-${dateParts[1].padStart(2, '0')}-${dateParts[0].padStart(2, '0')}`;
                document.getElementById('teacherAttendanceDate').value = isoDate;
                
                // Update date display
                setTeacherCurrentDate();
                
                // Re-render student list with loaded data
                renderTeacherStudentList();
                
                // Remove the existing attendance alert
                const existingAlert = document.getElementById('existingAttendanceAlert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // Show edit mode alert
                const editAlert = `
                    <div id="editModeAlert" class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <span class="text-green-600 text-lg">‚úèÔ∏è</span>
                            <div class="flex-1">
                                <div class="text-green-800 font-medium">Mode Edit Absensi</div>
                                <div class="text-green-700 text-sm">
                                    Data absensi yang sudah ada telah dimuat. Anda dapat mengubah status kehadiran siswa dan menyimpan perubahan.
                                </div>
                            </div>
                            <button onclick="document.getElementById('editModeAlert').remove()" 
                                    class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">
                                ‚úì Mengerti
                            </button>
                        </div>
                    </div>
                `;
                
                document.querySelector('.bg-white.rounded-xl.shadow-lg.p-6.mb-8').insertAdjacentHTML('afterend', editAlert);
                
                // Store the original save key for updating
                window.editingSaveKey = saveKey;
                
                logActivity(`${currentUser.name} memuat absensi untuk diedit: ${fullRecord.class} - ${fullRecord.subject} (${fullRecord.date})`);
                
            } catch (error) {
                console.error('Load existing attendance error:', error);
                alert('‚ùå Terjadi kesalahan saat memuat data absensi!');
            }
        }

        // Save teacher attendance
        function teacherSaveAttendance() {
            try {
                const classValue = document.getElementById('teacherClassSelect').value;
                const subject = document.getElementById('teacherSubjectSelect').value;
                const time = document.getElementById('teacherTimeSelect').value;
                const selectedDate = document.getElementById('teacherAttendanceDate').value;
                
                // Validate future date
                const today = new Date().toISOString().split('T')[0];
                if (selectedDate > today) {
                    alert('‚ùå Tidak dapat menyimpan absensi untuk tanggal masa depan!\n\nSilakan pilih tanggal hari ini atau sebelumnya.');
                    return;
                }
                
                const now = new Date();
                const date = new Date(selectedDate + 'T00:00:00').toLocaleDateString('id-ID');
                const timestamp = window.editingSaveKey ? parseInt(window.editingSaveKey.split('_').pop()) : now.getTime();

                // Get students for selected class
                const selectedClass = document.getElementById('teacherClassSelect').value;
                const classStudents = students.filter(student => student.class === selectedClass);

                // Calculate attendance summary
                const stats = {
                    present: 0,
                    excused: 0,
                    sick: 0,
                    absent: 0,
                    dispensasi: 0
                };

                classStudents.forEach(student => {
                    const status = teacherAttendance[student.id];
                    if (stats.hasOwnProperty(status)) {
                        stats[status]++;
                    }
                });

                const attendanceData = {
                    id: timestamp,
                    date: date,
                    class: classValue,
                    subject: subject,
                    time: time,
                    attendance: teacherAttendance,
                    studentNotes: teacherStudentNotes,
                    students: classStudents,
                    summary: stats,
                    savedAt: now.toISOString(),
                    savedBy: currentUser.name
                };

                // Save to localStorage
                const saveKey = window.editingSaveKey || `attendance_${classValue.replace(/\s+/g, '_')}_${timestamp}`;
                localStorage.setItem(saveKey, JSON.stringify(attendanceData));
                
                // Also save to list of all records
                let allRecords = [];
                try {
                    const existingRecords = localStorage.getItem('all_attendance_records');
                    if (existingRecords) {
                        allRecords = JSON.parse(existingRecords);
                    }
                } catch (e) {
                    allRecords = [];
                }
                
                if (window.editingSaveKey) {
                    // Update existing record
                    const recordIndex = allRecords.findIndex(record => record.saveKey === saveKey);
                    if (recordIndex > -1) {
                        allRecords[recordIndex] = {
                            id: timestamp,
                            date: date,
                            class: classValue,
                            subject: subject,
                            time: time,
                            summary: stats,
                            saveKey: saveKey,
                            savedBy: currentUser.name
                        };
                    }
                } else {
                    // Add new record
                    allRecords.push({
                        id: timestamp,
                        date: date,
                        class: classValue,
                        subject: subject,
                        time: time,
                        summary: stats,
                        saveKey: saveKey,
                        savedBy: currentUser.name
                    });
                }
                
                if (allRecords.length > 50) {
                    allRecords = allRecords.slice(-50);
                }
                
                localStorage.setItem('all_attendance_records', JSON.stringify(allRecords));
                
                // Log activity
                const actionType = window.editingSaveKey ? 'mengupdate' : 'menyimpan';
                logActivity(`${currentUser.name} ${actionType} absensi kelas ${classValue} mata pelajaran ${subject} (${date})`);
                
                // Show success message
                const actionText = window.editingSaveKey ? 'diupdate' : 'disimpan';
                const successMessage = `‚úÖ Absensi berhasil ${actionText}!\n\n` +
                    `üìã Detail ${window.editingSaveKey ? 'Update' : 'Penyimpanan'}:\n` +
                    `‚Ä¢ Kelas: ${classValue}\n` +
                    `‚Ä¢ Mata Pelajaran: ${subject}\n` +
                    `‚Ä¢ Waktu: ${time}\n` +
                    `‚Ä¢ Tanggal: ${date}\n\n` +
                    `üë• Ringkasan Kehadiran:\n` +
                    `‚Ä¢ Hadir: ${stats.present} siswa\n` +
                    `‚Ä¢ Izin: ${stats.excused} siswa\n` +
                    `‚Ä¢ Sakit: ${stats.sick} siswa\n` +
                    `‚Ä¢ Alpha: ${stats.absent} siswa\n` +
                    `‚Ä¢ Dispensasi: ${stats.dispensasi} siswa`;
                
                alert(successMessage);
                
                // Clear edit mode
                window.editingSaveKey = null;
                
                // Remove edit mode alert if exists
                const editAlert = document.getElementById('editModeAlert');
                if (editAlert) {
                    editAlert.remove();
                }
                
                // Reset date to today for next entry
                document.getElementById('teacherAttendanceDate').value = new Date().toISOString().split('T')[0];
                updateAttendanceDate();
                
            } catch (error) {
                console.error('Save error:', error);
                alert('‚ùå Terjadi kesalahan saat menyimpan data absensi.\n\nSilakan coba lagi.');
            }
        }

        // Show admin section
        function showAdminSection(section) {
            const sectionsDiv = document.getElementById('adminSections');
            sectionsDiv.classList.remove('hidden');
            
            let content = '';
            
            if (section === 'users') {
                content = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">üë• Kelola Pengguna</h3>
                        
                        <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-medium text-blue-800 mb-3">‚ûï Tambah Pengguna Baru</h4>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                                <input type="text" id="newUserName" placeholder="Nama Lengkap" class="px-3 py-2 border rounded-lg">
                                <input type="text" id="newUsername" placeholder="Username" class="px-3 py-2 border rounded-lg">
                                <input type="password" id="newPassword" placeholder="Password" class="px-3 py-2 border rounded-lg">
                                <select id="newUserRole" class="px-3 py-2 border rounded-lg">
                                    <option value="teacher">Guru</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                            <button onclick="addNewUser()" class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                ‚ûï Tambah Pengguna
                            </button>
                        </div>
                        
                        <div class="space-y-3">
                            <h4 class="font-medium text-gray-800">üìã Daftar Pengguna</h4>
                            <div id="usersList">
                                <!-- Users will be populated here -->
                            </div>
                        </div>
                    </div>
                `;
            } else if (section === 'classes') {
                content = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">üìö Kelola Kelas & Mata Pelajaran</h3>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="p-4 bg-green-50 rounded-lg">
                                <h4 class="font-medium text-green-800 mb-3">üè´ Kelola Kelas</h4>
                                <div class="flex gap-2 mb-3">
                                    <input type="text" id="newClassName" placeholder="Nama Kelas (contoh: XII IPA 3)" class="flex-1 px-3 py-2 border rounded-lg">
                                    <button onclick="addNewClass()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                        ‚ûï Tambah
                                    </button>
                                </div>
                                <div class="space-y-2 max-h-48 overflow-y-auto" id="classesList">
                                    <!-- Classes will be populated here -->
                                </div>
                            </div>
                            
                            <div class="p-4 bg-purple-50 rounded-lg">
                                <h4 class="font-medium text-purple-800 mb-3">üìñ Kelola Mata Pelajaran</h4>
                                <div class="flex gap-2 mb-3">
                                    <input type="text" id="newSubjectName" placeholder="Nama Mata Pelajaran" class="flex-1 px-3 py-2 border rounded-lg">
                                    <button onclick="addNewSubject()" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                                        ‚ûï Tambah
                                    </button>
                                </div>
                                <div class="space-y-2 max-h-48 overflow-y-auto" id="subjectsList">
                                    <!-- Subjects will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (section === 'reports') {
                content = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">üìä Laporan Absensi</h3>
                        
                        <div class="mb-6 p-4 bg-orange-50 rounded-lg">
                            <h4 class="font-medium text-orange-800 mb-3">üîç Filter Laporan</h4>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                                <select id="reportClass" class="px-3 py-2 border rounded-lg">
                                    <option value="">Semua Kelas</option>
                                    ${classes.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                                </select>
                                <input type="date" id="reportDateFrom" class="px-3 py-2 border rounded-lg">
                                <input type="date" id="reportDateTo" class="px-3 py-2 border rounded-lg">
                                <button onclick="generateReport()" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600">
                                    üìä Generate Laporan
                                </button>
                            </div>
                        </div>
                        
                        <div id="reportResults">
                            <p class="text-gray-500 text-center py-8">Pilih filter dan klik "Generate Laporan" untuk melihat data</p>
                        </div>
                    </div>
                `;
            } else if (section === 'settings') {
                content = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">‚öôÔ∏è Pengaturan Sistem</h3>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-medium text-blue-800 mb-3">üé® Kustomisasi Logo</h4>
                                <p class="text-sm text-blue-700 mb-3">Ubah logo sekolah yang ditampilkan di sistem</p>
                                <button onclick="showLogoCustomization()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                    üé® Edit Logo
                                </button>
                            </div>
                            
                            <div class="p-4 bg-green-50 rounded-lg">
                                <h4 class="font-medium text-green-800 mb-3">üíæ Backup & Restore</h4>
                                <p class="text-sm text-green-700 mb-3">Backup dan restore data sistem</p>
                                <div class="space-y-2">
                                    <button onclick="backupData()" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                        üì• Backup Data
                                    </button>
                                    <button onclick="restoreData()" class="w-full px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                                        üì§ Restore Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (section === 'logs') {
                content = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">üìã Log Aktivitas Sistem</h3>
                        
                        <div class="mb-4">
                            <button onclick="clearLogs()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                üóëÔ∏è Hapus Semua Log
                            </button>
                        </div>
                        
                        <div class="space-y-3 max-h-96 overflow-y-auto" id="systemLogs">
                            <!-- Logs will be populated here -->
                        </div>
                    </div>
                `;
            }
            
            sectionsDiv.innerHTML = content;
            
            // Populate data based on section
            if (section === 'users') {
                populateUsersList();
            } else if (section === 'classes') {
                populateClassesList();
                populateSubjectsList();
            } else if (section === 'logs') {
                populateSystemLogs();
            }
        }

        // Show teacher section
        function showTeacherSection(section) {
            const sectionsDiv = document.getElementById('teacherSections');
            
            if (section === 'attendance') {
                sectionsDiv.innerHTML = `
                    <div id="attendanceSection" class="fade-in">
                        <!-- Class Info -->
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                    <select id="teacherClassSelect" onchange="renderTeacherStudentList(); checkExistingAttendance();" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        ${classes.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                                    <select id="teacherSubjectSelect" onchange="checkExistingAttendance();" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="Matematika">Matematika</option>
                                        <option value="Fisika">Fisika</option>
                                        <option value="Kimia">Kimia</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jam Pelajaran</label>
                                    <select id="teacherTimeSelect" onchange="checkExistingAttendance();" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        ${timePeriods.map(time => `<option value="${time}">${time}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ Tanggal Absensi</label>
                                    <input type="date" id="teacherAttendanceDate" value="${new Date().toISOString().split('T')[0]}" 
                                           onchange="updateAttendanceDate()"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                            
                            <!-- Date Info Alert -->
                            <div id="dateInfoAlert" class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg hidden">
                                <div class="flex items-center space-x-2">
                                    <span class="text-blue-600">‚ÑπÔ∏è</span>
                                    <span class="text-blue-800 text-sm font-medium" id="dateInfoText"></span>
                                </div>
                            </div>
                            
                            <!-- Past Date Warning -->
                            <div id="pastDateWarning" class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg hidden">
                                <div class="flex items-center space-x-2">
                                    <span class="text-yellow-600">‚ö†Ô∏è</span>
                                    <span class="text-yellow-800 text-sm">
                                        <strong>Perhatian:</strong> Anda sedang mengisi absensi untuk tanggal yang sudah berlalu. 
                                        Pastikan data yang diisi sudah benar.
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Future Date Warning -->
                            <div id="futureDateWarning" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg hidden">
                                <div class="flex items-center space-x-2">
                                    <span class="text-red-600">üö´</span>
                                    <span class="text-red-800 text-sm">
                                        <strong>Peringatan:</strong> Tanggal yang dipilih adalah tanggal masa depan. 
                                        Silakan pilih tanggal hari ini atau sebelumnya.
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Quick Date Selection -->
                            <div class="mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-700">‚ö° Pilih Tanggal Cepat:</span>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="setQuickDate(0)" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 transition-colors">
                                        üìÖ Hari Ini
                                    </button>
                                    <button onclick="setQuickDate(-1)" class="px-3 py-1 bg-yellow-500 text-white rounded text-sm hover:bg-yellow-600 transition-colors">
                                        üìÖ Kemarin
                                    </button>
                                    <button onclick="setQuickDate(-2)" class="px-3 py-1 bg-orange-500 text-white rounded text-sm hover:bg-orange-600 transition-colors">
                                        üìÖ 2 Hari Lalu
                                    </button>
                                    <button onclick="setQuickDate(-3)" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600 transition-colors">
                                        üìÖ 3 Hari Lalu
                                    </button>
                                    <button onclick="showDatePicker()" class="px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600 transition-colors">
                                        üìÖ Pilih Tanggal Lain
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Student List for Attendance -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-xl font-semibold text-gray-800">Daftar Kehadiran Siswa</h2>
                                <div class="text-sm text-gray-500" id="teacherCurrentDate"></div>
                            </div>

                            <!-- Summary Stats -->
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                    <div class="text-green-600 text-sm font-medium">Hadir</div>
                                    <div class="text-2xl font-bold text-green-700" id="teacherPresentCount">0</div>
                                </div>
                                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                    <div class="text-yellow-600 text-sm font-medium">Izin</div>
                                    <div class="text-2xl font-bold text-yellow-700" id="teacherExcusedCount">0</div>
                                </div>
                                <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                    <div class="text-red-600 text-sm font-medium">Sakit</div>
                                    <div class="text-2xl font-bold text-red-700" id="teacherSickCount">0</div>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <div class="text-gray-600 text-sm font-medium">Alpha</div>
                                    <div class="text-2xl font-bold text-gray-700" id="teacherAbsentCount">0</div>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                    <div class="text-purple-600 text-sm font-medium">Dispensasi</div>
                                    <div class="text-2xl font-bold text-purple-700" id="teacherDispensasiCount">0</div>
                                </div>
                            </div>

                            <!-- Student List -->
                            <div class="space-y-3" id="teacherStudentList">
                                <!-- Students will be populated by JavaScript -->
                            </div>

                            <!-- Action Buttons -->
                            <div class="mt-8 flex gap-4 justify-center">
                                <button onclick="teacherMarkAllPresent()" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium">
                                    ‚úì Semua Hadir
                                </button>
                                <button onclick="teacherSaveAttendance()" class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                    üíæ Simpan Absensi
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                setTeacherCurrentDate();
                renderTeacherStudentList();
            } else if (section === 'history') {
                sectionsDiv.innerHTML = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">üìö Riwayat Absensi Saya</h3>
                        <div id="teacherHistory">
                            <!-- History will be populated here -->
                        </div>
                    </div>
                `;
                populateTeacherHistory();
            } else if (section === 'download') {
                sectionsDiv.innerHTML = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">üì• Download Hasil Absensi</h3>
                        
                        <!-- Filter Section -->
                        <div class="bg-blue-50 p-6 rounded-lg mb-6">
                            <h4 class="font-medium text-blue-800 mb-4">üîç Filter Data untuk Download</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                    <select id="downloadClassFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">Semua Kelas Saya</option>
                                        ${classes.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                                    <select id="downloadSubjectFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">Semua Mata Pelajaran</option>
                                        <option value="Matematika">Matematika</option>
                                        <option value="Fisika">Fisika</option>
                                        <option value="Kimia">Kimia</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Dari Tanggal</label>
                                    <input type="date" id="downloadDateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Sampai Tanggal</label>
                                    <input type="date" id="downloadDateTo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                            <div class="mt-4">
                                <button onclick="previewDownloadData()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                    üëÅÔ∏è Preview Data
                                </button>
                            </div>
                        </div>

                        <!-- Preview Section -->
                        <div id="downloadPreview" class="hidden mb-6">
                            <h4 class="font-medium text-gray-800 mb-4">üìã Preview Data yang akan di-download</h4>
                            <div id="downloadPreviewContent" class="bg-gray-50 p-4 rounded-lg border max-h-96 overflow-y-auto">
                                <!-- Preview content will be populated here -->
                            </div>
                        </div>

                        <!-- Download Options -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Excel Download -->
                            <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                        <span class="text-2xl">üìä</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-green-800">Download Excel (CSV)</h4>
                                        <p class="text-sm text-green-600">Format spreadsheet untuk analisis data</p>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <button onclick="downloadTeacherExcel('summary')" class="w-full px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                        üìä Download Ringkasan Excel
                                    </button>
                                    <button onclick="downloadTeacherExcel('detailed')" class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                        üìã Download Detail Lengkap Excel
                                    </button>
                                </div>
                                <p class="text-xs text-green-700 mt-3">
                                    üí° File Excel dapat dibuka di Microsoft Excel, Google Sheets, atau LibreOffice Calc
                                </p>
                            </div>

                            <!-- PDF Download -->
                            <div class="bg-red-50 p-6 rounded-lg border border-red-200">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                                        <span class="text-2xl">üìÑ</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-red-800">Download PDF</h4>
                                        <p class="text-sm text-red-600">Format dokumen untuk laporan resmi</p>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <button onclick="downloadTeacherPDF('summary')" class="w-full px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                        üìÑ Download Laporan Ringkasan PDF
                                    </button>
                                    <button onclick="downloadTeacherPDF('detailed')" class="w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                        üìã Download Laporan Detail PDF
                                    </button>
                                </div>
                                <p class="text-xs text-red-700 mt-3">
                                    üí° File PDF siap untuk dicetak atau dikirim sebagai laporan resmi
                                </p>
                            </div>
                        </div>

                        <!-- Quick Download Presets -->
                        <div class="mt-8 bg-purple-50 p-6 rounded-lg border border-purple-200">
                            <h4 class="font-medium text-purple-800 mb-4">‚ö° Download Cepat</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <button onclick="quickDownload('today')" class="px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                                    üìÖ Absensi Hari Ini
                                </button>
                                <button onclick="quickDownload('week')" class="px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                                    üìÜ Absensi Minggu Ini
                                </button>
                                <button onclick="quickDownload('month')" class="px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                                    üóìÔ∏è Absensi Bulan Ini
                                </button>
                            </div>
                        </div>

                        <!-- Statistics -->
                        <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                            <h5 class="font-medium text-gray-800 mb-3">üìä Statistik Data Saya</h5>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                                <div class="bg-white p-3 rounded border">
                                    <div class="text-2xl font-bold text-blue-600" id="teacherTotalRecords">0</div>
                                    <div class="text-sm text-gray-600">Total Absensi</div>
                                </div>
                                <div class="bg-white p-3 rounded border">
                                    <div class="text-2xl font-bold text-green-600" id="teacherTotalClasses">0</div>
                                    <div class="text-sm text-gray-600">Kelas Diajar</div>
                                </div>
                                <div class="bg-white p-3 rounded border">
                                    <div class="text-2xl font-bold text-orange-600" id="teacherTotalStudents">0</div>
                                    <div class="text-sm text-gray-600">Total Siswa</div>
                                </div>
                                <div class="bg-white p-3 rounded border">
                                    <div class="text-2xl font-bold text-purple-600" id="teacherAvgAttendance">0%</div>
                                    <div class="text-sm text-gray-600">Rata-rata Kehadiran</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                updateTeacherDownloadStats();
            } else if (section === 'journal') {
                sectionsDiv.innerHTML = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">üìñ Jurnal Mengajar</h3>
                        
                        <!-- Add New Journal Entry -->
                        <div class="bg-blue-50 p-6 rounded-lg mb-6 border border-blue-200">
                            <h4 class="font-medium text-blue-800 mb-4">‚ûï Tambah Jurnal Mengajar Baru</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                    <select id="journalClass" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        ${classes.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                                    <select id="journalSubject" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="Matematika">Matematika</option>
                                        <option value="Fisika">Fisika</option>
                                        <option value="Kimia">Kimia</option>
                                        <option value="Biologi">Biologi</option>
                                        <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                                        <option value="Bahasa Inggris">Bahasa Inggris</option>
                                        <option value="Sejarah">Sejarah</option>
                                        <option value="Geografi">Geografi</option>
                                        <option value="Ekonomi">Ekonomi</option>
                                        <option value="Sosiologi">Sosiologi</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                                    <input type="date" id="journalDate" value="${new Date().toISOString().split('T')[0]}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jam Pelajaran</label>
                                    <select id="journalTime" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        ${timePeriods.map(time => `<option value="${time}">${time}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pertemuan Ke-</label>
                                    <input type="number" id="journalMeeting" min="1" max="50" value="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="1">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tema/Materi Pembelajaran</label>
                                <input type="text" id="journalTheme" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Contoh: Sistem Persamaan Linear Dua Variabel">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kompetensi Dasar (KD)</label>
                                <input type="text" id="journalKD" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Contoh: 3.2 Menjelaskan dan menentukan penyelesaian sistem persamaan linear">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kegiatan Pembelajaran</label>
                                <textarea id="journalActivity" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Jelaskan kegiatan pembelajaran yang dilakukan..."></textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Metode Pembelajaran</label>
                                    <select id="journalMethod" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="Ceramah">Ceramah</option>
                                        <option value="Diskusi">Diskusi</option>
                                        <option value="Tanya Jawab">Tanya Jawab</option>
                                        <option value="Demonstrasi">Demonstrasi</option>
                                        <option value="Praktikum">Praktikum</option>
                                        <option value="Presentasi">Presentasi</option>
                                        <option value="Problem Based Learning">Problem Based Learning</option>
                                        <option value="Project Based Learning">Project Based Learning</option>
                                        <option value="Discovery Learning">Discovery Learning</option>
                                        <option value="Cooperative Learning">Cooperative Learning</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Media Pembelajaran</label>
                                    <input type="text" id="journalMedia" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Contoh: Papan tulis, LCD Proyektor, Laptop">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Catatan/Refleksi</label>
                                <textarea id="journalNotes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Catatan tambahan, kendala, atau refleksi pembelajaran..."></textarea>
                            </div>
                            <button onclick="saveJournalEntry()" class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                üíæ Simpan Jurnal Mengajar
                            </button>
                        </div>
                        
                        <!-- Journal History -->
                        <div id="journalHistory">
                            <!-- Journal entries will be populated here -->
                        </div>
                    </div>
                `;
                populateJournalHistory();
            } else if (section === 'profile') {
                sectionsDiv.innerHTML = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">üë§ Profil Saya</h3>
                        
                        <div class="max-w-md">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                <input type="text" value="${currentUser.name}" class="w-full px-3 py-2 border rounded-lg" readonly>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                <input type="text" value="${currentUser.username}" class="w-full px-3 py-2 border rounded-lg" readonly>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                                <input type="text" value="${currentUser.role === 'teacher' ? 'Guru' : 'Admin'}" class="w-full px-3 py-2 border rounded-lg" readonly>
                            </div>
                            
                            <div class="p-4 bg-yellow-50 rounded-lg">
                                <p class="text-sm text-yellow-800">
                                    üí° <strong>Info:</strong> Untuk mengubah profil atau password, silakan hubungi Administrator sistem.
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Populate functions
        function populateUsersList() {
            const container = document.getElementById('usersList');
            container.innerHTML = '';
            
            Object.keys(accounts).forEach(key => {
                const user = accounts[key];
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-blue-600 text-sm">${user.role === 'admin' ? 'üîß' : 'üë®‚Äçüè´'}</span>
                        </div>
                        <div>
                            <div class="font-medium">${user.name}</div>
                            <div class="text-sm text-gray-500">@${user.username} ‚Ä¢ ${user.role === 'admin' ? 'Administrator' : 'Guru'}</div>
                        </div>
                    </div>
                    <button onclick="deleteUser('${key}')" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm">
                        üóëÔ∏è Hapus
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function populateClassesList() {
            const container = document.getElementById('classesList');
            container.innerHTML = '';
            
            classes.forEach(className => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-2 bg-white rounded border';
                div.innerHTML = `
                    <span class="text-sm">${className}</span>
                    <button onclick="deleteClass('${className}')" class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">
                        üóëÔ∏è
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function populateSubjectsList() {
            const container = document.getElementById('subjectsList');
            container.innerHTML = '';
            
            subjects.forEach(subjectName => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-2 bg-white rounded border';
                div.innerHTML = `
                    <span class="text-sm">${subjectName}</span>
                    <button onclick="deleteSubject('${subjectName}')" class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">
                        üóëÔ∏è
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function populateTeacherHistory() {
            const container = document.getElementById('teacherHistory');
            
            try {
                const allRecords = localStorage.getItem('all_attendance_records');
                if (allRecords) {
                    const records = JSON.parse(allRecords);
                    const myRecords = records.filter(record => record.savedBy === currentUser.name);
                    
                    if (myRecords.length === 0) {
                        container.innerHTML = `
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">üìö</div>
                                <h3 class="text-lg font-medium text-gray-800 mb-2">Belum Ada Riwayat Absensi</h3>
                                <p class="text-gray-600 mb-6">Anda belum pernah menyimpan data absensi. Mulai buat absensi pertama Anda!</p>
                                <button onclick="showTeacherSection('attendance')" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                    ‚ûï Buat Absensi Baru
                                </button>
                            </div>
                        `;
                        return;
                    }
                    
                    // Sort records by date (newest first)
                    myRecords.sort((a, b) => {
                        const dateA = new Date(a.date.split('/').reverse().join('-'));
                        const dateB = new Date(b.date.split('/').reverse().join('-'));
                        return dateB - dateA;
                    });
                    
                    container.innerHTML = `
                        <div class="space-y-4">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-semibold text-gray-800">üìã Riwayat Absensi Saya (${myRecords.length} record)</h4>
                                <div class="flex space-x-2">
                                    <button onclick="showTeacherSection('attendance')" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm">
                                        ‚ûï Buat Baru
                                    </button>
                                    <button onclick="showTeacherSection('download')" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm">
                                        üì• Download
                                    </button>
                                </div>
                            </div>
                            
                            ${myRecords.map((record, index) => {
                                const totalStudents = Object.values(record.summary).reduce((a, b) => a + b, 0);
                                const attendanceRate = totalStudents > 0 ? Math.round((record.summary.present / totalStudents) * 100) : 0;
                                
                                return `
                                    <div class="bg-white p-6 rounded-xl shadow-lg border hover:shadow-xl transition-shadow">
                                        <div class="flex items-start justify-between mb-4">
                                            <div class="flex-1">
                                                <div class="flex items-center space-x-3 mb-2">
                                                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">#${index + 1}</span>
                                                    <h5 class="text-lg font-semibold text-gray-800">${record.class}</h5>
                                                    <span class="text-gray-400">‚Ä¢</span>
                                                    <span class="text-gray-700">${record.subject}</span>
                                                </div>
                                                <div class="flex items-center space-x-4 text-sm text-gray-600">
                                                    <span class="flex items-center space-x-1">
                                                        <span>üìÖ</span>
                                                        <span>${record.date}</span>
                                                    </span>
                                                    <span class="flex items-center space-x-1">
                                                        <span>‚è∞</span>
                                                        <span>${record.time}</span>
                                                    </span>
                                                    <span class="flex items-center space-x-1">
                                                        <span>üë•</span>
                                                        <span>${totalStudents} siswa</span>
                                                    </span>
                                                    <span class="flex items-center space-x-1">
                                                        <span>üìä</span>
                                                        <span class="font-medium ${attendanceRate >= 80 ? 'text-green-600' : attendanceRate >= 60 ? 'text-yellow-600' : 'text-red-600'}">${attendanceRate}% hadir</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <button onclick="viewAttendanceDetail('${record.saveKey}')" class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 text-sm transition-colors">
                                                üëÅÔ∏è Lihat Detail
                                            </button>
                                        </div>
                                        
                                        <!-- Summary Stats -->
                                        <div class="grid grid-cols-5 gap-3">
                                            <div class="bg-green-50 p-3 rounded-lg border border-green-200 text-center">
                                                <div class="text-green-600 text-xs font-medium mb-1">Hadir</div>
                                                <div class="text-xl font-bold text-green-700">${record.summary.present}</div>
                                            </div>
                                            <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-center">
                                                <div class="text-yellow-600 text-xs font-medium mb-1">Izin</div>
                                                <div class="text-xl font-bold text-yellow-700">${record.summary.excused}</div>
                                            </div>
                                            <div class="bg-orange-50 p-3 rounded-lg border border-orange-200 text-center">
                                                <div class="text-orange-600 text-xs font-medium mb-1">Sakit</div>
                                                <div class="text-xl font-bold text-orange-700">${record.summary.sick}</div>
                                            </div>
                                            <div class="bg-red-50 p-3 rounded-lg border border-red-200 text-center">
                                                <div class="text-red-600 text-xs font-medium mb-1">Alpha</div>
                                                <div class="text-xl font-bold text-red-700">${record.summary.absent}</div>
                                            </div>
                                            <div class="bg-purple-50 p-3 rounded-lg border border-purple-200 text-center">
                                                <div class="text-purple-600 text-xs font-medium mb-1">Dispensasi</div>
                                                <div class="text-xl font-bold text-purple-700">${record.summary.dispensasi}</div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">üìö</div>
                            <h3 class="text-lg font-medium text-gray-800 mb-2">Belum Ada Data Absensi</h3>
                            <p class="text-gray-600 mb-6">Sistem belum memiliki data absensi tersimpan.</p>
                            <button onclick="showTeacherSection('attendance')" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                ‚ûï Buat Absensi Pertama
                            </button>
                        </div>
                    `;
                }
            } catch (e) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">‚ùå</div>
                        <h3 class="text-lg font-medium text-red-800 mb-2">Error Memuat Data</h3>
                        <p class="text-red-600 mb-6">Terjadi kesalahan saat memuat riwayat absensi.</p>
                        <button onclick="populateTeacherHistory()" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            üîÑ Coba Lagi
                        </button>
                    </div>
                `;
            }
        }

        function populateSystemLogs() {
            const container = document.getElementById('systemLogs');
            
            try {
                const logs = localStorage.getItem('system_logs');
                if (logs) {
                    const logEntries = JSON.parse(logs);
                    
                    if (logEntries.length === 0) {
                        container.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada log aktivitas</p>';
                        return;
                    }
                    
                    container.innerHTML = logEntries.reverse().map(log => `
                        <div class="p-3 bg-gray-50 rounded-lg border">
                            <div class="flex items-center justify-between">
                                <div class="text-sm">${log.activity}</div>
                                <div class="text-xs text-gray-500">${log.timestamp}</div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada log aktivitas</p>';
                }
            } catch (e) {
                container.innerHTML = '<p class="text-red-500 text-center py-8">Error loading logs</p>';
            }
        }

        // Admin functions
        function addNewUser() {
            const name = document.getElementById('newUserName').value.trim();
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value.trim();
            const role = document.getElementById('newUserRole').value;
            
            if (!name || !username || !password) {
                alert('‚ùå Mohon isi semua field!');
                return;
            }
            
            if (accounts[username]) {
                alert('‚ùå Username sudah ada!');
                return;
            }
            
            accounts[username] = { username, password, role, name };
            
            // Clear form
            document.getElementById('newUserName').value = '';
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            
            populateUsersList();
            logActivity(`Admin menambah pengguna baru: ${name} (${username})`);
            alert('‚úÖ Pengguna berhasil ditambahkan!');
        }

        function deleteUser(userKey) {
            if (userKey === 'admin') {
                alert('‚ùå Tidak dapat menghapus akun admin utama!');
                return;
            }
            
            if (confirm('‚ö†Ô∏è Hapus pengguna ini?')) {
                const user = accounts[userKey];
                delete accounts[userKey];
                populateUsersList();
                logActivity(`Admin menghapus pengguna: ${user.name}`);
                alert('‚úÖ Pengguna berhasil dihapus!');
            }
        }

        function addNewClass() {
            const className = document.getElementById('newClassName').value.trim();
            
            if (!className) {
                alert('‚ùå Mohon isi nama kelas!');
                return;
            }
            
            if (classes.includes(className)) {
                alert('‚ùå Kelas sudah ada!');
                return;
            }
            
            classes.push(className);
            classes.sort();
            document.getElementById('newClassName').value = '';
            populateClassesList();
            logActivity(`Admin menambah kelas: ${className}`);
            alert('‚úÖ Kelas berhasil ditambahkan!');
        }

        function deleteClass(className) {
            if (confirm('‚ö†Ô∏è Hapus kelas ini?')) {
                const index = classes.indexOf(className);
                if (index > -1) {
                    classes.splice(index, 1);
                    populateClassesList();
                    logActivity(`Admin menghapus kelas: ${className}`);
                    alert('‚úÖ Kelas berhasil dihapus!');
                }
            }
        }

        function addNewSubject() {
            const subjectName = document.getElementById('newSubjectName').value.trim();
            
            if (!subjectName) {
                alert('‚ùå Mohon isi nama mata pelajaran!');
                return;
            }
            
            if (subjects.includes(subjectName)) {
                alert('‚ùå Mata pelajaran sudah ada!');
                return;
            }
            
            subjects.push(subjectName);
            subjects.sort();
            document.getElementById('newSubjectName').value = '';
            populateSubjectsList();
            logActivity(`Admin menambah mata pelajaran: ${subjectName}`);
            alert('‚úÖ Mata pelajaran berhasil ditambahkan!');
        }

        function deleteSubject(subjectName) {
            if (confirm('‚ö†Ô∏è Hapus mata pelajaran ini?')) {
                const index = subjects.indexOf(subjectName);
                if (index > -1) {
                    subjects.splice(index, 1);
                    populateSubjectsList();
                    logActivity(`Admin menghapus mata pelajaran: ${subjectName}`);
                    alert('‚úÖ Mata pelajaran berhasil dihapus!');
                }
            }
        }

        function generateReport() {
            const reportClass = document.getElementById('reportClass').value;
            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;
            
            try {
                const allRecords = localStorage.getItem('all_attendance_records');
                if (!allRecords) {
                    document.getElementById('reportResults').innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada data absensi</p>';
                    return;
                }
                
                let records = JSON.parse(allRecords);
                
                // Filter by class
                if (reportClass) {
                    records = records.filter(record => record.class === reportClass);
                }
                
                // Filter by date range
                if (dateFrom || dateTo) {
                    records = records.filter(record => {
                        const recordDate = new Date(record.date.split('/').reverse().join('-'));
                        const fromDate = dateFrom ? new Date(dateFrom) : new Date('1900-01-01');
                        const toDate = dateTo ? new Date(dateTo) : new Date('2100-12-31');
                        return recordDate >= fromDate && recordDate <= toDate;
                    });
                }
                
                if (records.length === 0) {
                    document.getElementById('reportResults').innerHTML = '<p class="text-gray-500 text-center py-8">Tidak ada data sesuai filter</p>';
                    return;
                }
                
                // Generate report
                const reportHTML = `
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h4 class="font-medium text-gray-800">üìä Hasil Laporan (${records.length} record)</h4>
                            <button onclick="exportReport()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                üì• Export CSV
                            </button>
                        </div>
                        ${records.map(record => `
                            <div class="p-4 bg-gray-50 rounded-lg border">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <div class="font-medium">${record.class} - ${record.subject}</div>
                                        <div class="text-sm text-gray-600">${record.date} ‚Ä¢ ${record.time}</div>
                                        <div class="text-sm text-gray-600">Oleh: ${record.savedBy || 'Unknown'}</div>
                                    </div>
                                    <div class="grid grid-cols-5 gap-2 text-center">
                                        <div class="bg-green-100 p-2 rounded">
                                            <div class="text-xs text-green-600">Hadir</div>
                                            <div class="font-bold text-green-700">${record.summary.present}</div>
                                        </div>
                                        <div class="bg-yellow-100 p-2 rounded">
                                            <div class="text-xs text-yellow-600">Izin</div>
                                            <div class="font-bold text-yellow-700">${record.summary.excused}</div>
                                        </div>
                                        <div class="bg-red-100 p-2 rounded">
                                            <div class="text-xs text-red-600">Sakit</div>
                                            <div class="font-bold text-red-700">${record.summary.sick}</div>
                                        </div>
                                        <div class="bg-gray-100 p-2 rounded">
                                            <div class="text-xs text-gray-600">Alpha</div>
                                            <div class="font-bold text-gray-700">${record.summary.absent}</div>
                                        </div>
                                        <div class="bg-purple-100 p-2 rounded">
                                            <div class="text-xs text-purple-600">Dispensasi</div>
                                            <div class="font-bold text-purple-700">${record.summary.dispensasi}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                document.getElementById('reportResults').innerHTML = reportHTML;
                
            } catch (e) {
                document.getElementById('reportResults').innerHTML = '<p class="text-red-500 text-center py-8">Error generating report</p>';
            }
        }

        function showLogoCustomization() {
            const sectionsDiv = document.getElementById('adminSections');
            sectionsDiv.innerHTML = `
                <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">üé® Kustomisasi Logo Sekolah</h3>
                        <button onclick="showAdminSection('settings')" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            ‚Üê Kembali
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Logo Preview -->
                        <div class="space-y-6">
                            <div class="text-center">
                                <h4 class="font-medium text-gray-800 mb-4">üëÅÔ∏è Preview Logo</h4>
                                <div class="bg-gray-50 p-8 rounded-lg border-2 border-dashed border-gray-300">
                                    <div id="logoPreview" class="flex justify-center">
                                        ${generateLogoSVG(currentLogoConfig, 120)}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Logo in Context -->
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h5 class="font-medium text-blue-800 mb-3">üì± Preview di Header</h5>
                                <div class="bg-white p-3 rounded border flex items-center space-x-3">
                                    <div id="headerPreview">
                                        ${generateLogoSVG(currentLogoConfig, 50)}
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-800">Sistem Absensi Digital</div>
                                        <div class="text-sm text-gray-600">SMAN 5 Taruna Brawijaya</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Logo Settings -->
                        <div class="space-y-6">
                            <div>
                                <h4 class="font-medium text-gray-800 mb-4">‚öôÔ∏è Pengaturan Logo</h4>
                                
                                <!-- School Names -->
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üè´ Nama Sekolah Baris 1</label>
                                        <input type="text" id="schoolName1" value="${currentLogoConfig.schoolName1}" 
                                               onchange="updateLogoConfig()" maxlength="10"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                               placeholder="Contoh: SMAN 5">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üè´ Nama Sekolah Baris 2</label>
                                        <input type="text" id="schoolName2" value="${currentLogoConfig.schoolName2}" 
                                               onchange="updateLogoConfig()" maxlength="10"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                               placeholder="Contoh: TARUNA">
                                    </div>
                                </div>
                                
                                <!-- Colors -->
                                <div class="grid grid-cols-2 gap-4 mt-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üé® Warna Utama</label>
                                        <div class="flex space-x-2">
                                            <input type="color" id="primaryColor" value="${currentLogoConfig.primaryColor}" 
                                                   onchange="updateLogoConfig()"
                                                   class="w-12 h-10 border border-gray-300 rounded cursor-pointer">
                                            <input type="text" value="${currentLogoConfig.primaryColor}" 
                                                   onchange="document.getElementById('primaryColor').value = this.value; updateLogoConfig()"
                                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üé® Warna Sekunder</label>
                                        <div class="flex space-x-2">
                                            <input type="color" id="secondaryColor" value="${currentLogoConfig.secondaryColor}" 
                                                   onchange="updateLogoConfig()"
                                                   class="w-12 h-10 border border-gray-300 rounded cursor-pointer">
                                            <input type="text" value="${currentLogoConfig.secondaryColor}" 
                                                   onchange="document.getElementById('secondaryColor').value = this.value; updateLogoConfig()"
                                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Logo Size -->
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìè Ukuran Logo (px)</label>
                                    <input type="range" id="logoSize" min="60" max="150" value="${currentLogoConfig.logoSize}" 
                                           onchange="updateLogoConfig()" 
                                           class="w-full">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>60px</span>
                                        <span id="logoSizeValue">${currentLogoConfig.logoSize}px</span>
                                        <span>150px</span>
                                    </div>
                                </div>
                                
                                <!-- Import Custom Logo -->
                                <div class="mt-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-3">üìÅ Import Logo Custom</label>
                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 transition-colors">
                                        <input type="file" id="logoFileInput" accept="image/*" onchange="handleLogoUpload(event)" class="hidden">
                                        <button onclick="document.getElementById('logoFileInput').click()" 
                                                class="w-full px-4 py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors">
                                            üìÅ Pilih File Logo
                                        </button>
                                        <p class="text-xs text-gray-500 mt-2">Format: PNG, JPG, SVG (Max: 2MB)</p>
                                        <div id="customLogoPreview" class="mt-3 hidden">
                                            <div class="text-sm text-gray-600 mb-2">Preview Logo Custom:</div>
                                            <div id="customLogoImage" class="flex justify-center"></div>
                                            <button onclick="removeCustomLogo()" class="mt-2 px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">
                                                üóëÔ∏è Hapus Logo Custom
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Preset Colors -->
                                <div class="mt-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-3">üé® Preset Warna</label>
                                    <div class="grid grid-cols-4 gap-2">
                                        <button onclick="applyColorPreset('#DC2626', '#1E40AF')" 
                                                class="h-10 rounded border-2 border-gray-300 hover:border-gray-400" 
                                                style="background: linear-gradient(45deg, #DC2626 50%, #1E40AF 50%);" 
                                                title="Merah-Biru (Default)"></button>
                                        <button onclick="applyColorPreset('#059669', '#7C3AED')" 
                                                class="h-10 rounded border-2 border-gray-300 hover:border-gray-400" 
                                                style="background: linear-gradient(45deg, #059669 50%, #7C3AED 50%);" 
                                                title="Hijau-Ungu"></button>
                                        <button onclick="applyColorPreset('#EA580C', '#0284C7')" 
                                                class="h-10 rounded border-2 border-gray-300 hover:border-gray-400" 
                                                style="background: linear-gradient(45deg, #EA580C 50%, #0284C7 50%);" 
                                                title="Orange-Biru"></button>
                                        <button onclick="applyColorPreset('#BE185D', '#059669')" 
                                                class="h-10 rounded border-2 border-gray-300 hover:border-gray-400" 
                                                style="background: linear-gradient(45deg, #BE185D 50%, #059669 50%);" 
                                                title="Pink-Hijau"></button>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="mt-8 space-y-3">
                                    <button onclick="saveLogoConfig()" 
                                            class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                                        üíæ Simpan Perubahan
                                    </button>
                                    <button onclick="resetLogoConfig()" 
                                            class="w-full px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                                        üîÑ Reset ke Default
                                    </button>
                                    <button onclick="downloadLogo()" 
                                            class="w-full px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                        üì• Download Logo SVG
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Show custom logo preview if exists
            if (currentLogoConfig.customImage) {
                setTimeout(() => {
                    showCustomLogoPreview(currentLogoConfig.customImage);
                }, 100);
            }
        }

        function updateLogoConfig() {
            // Get values from form
            currentLogoConfig.schoolName1 = document.getElementById('schoolName1').value || 'SMAN 5';
            currentLogoConfig.schoolName2 = document.getElementById('schoolName2').value || 'TARUNA';
            currentLogoConfig.primaryColor = document.getElementById('primaryColor').value;
            currentLogoConfig.secondaryColor = document.getElementById('secondaryColor').value;
            currentLogoConfig.logoSize = document.getElementById('logoSize').value;
            
            // Update size display
            document.getElementById('logoSizeValue').textContent = currentLogoConfig.logoSize + 'px';
            
            // Update previews
            document.getElementById('logoPreview').innerHTML = generateLogoSVG(currentLogoConfig, 120);
            document.getElementById('headerPreview').innerHTML = generateLogoSVG(currentLogoConfig, 50);
        }

        function applyColorPreset(primary, secondary) {
            currentLogoConfig.primaryColor = primary;
            currentLogoConfig.secondaryColor = secondary;
            
            // Update form inputs
            document.getElementById('primaryColor').value = primary;
            document.getElementById('secondaryColor').value = secondary;
            document.querySelector('input[type="text"][onchange*="primaryColor"]').value = primary;
            document.querySelector('input[type="text"][onchange*="secondaryColor"]').value = secondary;
            
            updateLogoConfig();
        }

        function saveLogoConfig() {
            try {
                // Save to localStorage
                localStorage.setItem('logo_config', JSON.stringify(currentLogoConfig));
                
                // Update all logos in the system
                const adminLogo = document.getElementById('adminLogo');
                const teacherLogo = document.getElementById('teacherLogo');
                const loginLogo = document.getElementById('loginLogo');
                
                if (adminLogo) adminLogo.innerHTML = generateLogoSVG(currentLogoConfig, 60);
                if (teacherLogo) teacherLogo.innerHTML = generateLogoSVG(currentLogoConfig, 60);
                if (loginLogo) loginLogo.innerHTML = generateLogoSVG(currentLogoConfig, 100);
                
                logActivity('Admin mengubah konfigurasi logo sistem');
                alert('‚úÖ Logo berhasil disimpan dan diterapkan ke seluruh sistem!');
                
            } catch (e) {
                alert('‚ùå Gagal menyimpan konfigurasi logo!');
            }
        }

        function resetLogoConfig() {
            if (confirm('üîÑ Reset logo ke pengaturan default?')) {
                currentLogoConfig = {
                    schoolName1: 'SMAN 5',
                    schoolName2: 'TARUNA',
                    primaryColor: '#DC2626',
                    secondaryColor: '#1E40AF',
                    logoStyle: 'garuda',
                    logoSize: '80',
                    customImage: null
                };
                
                // Update form
                document.getElementById('schoolName1').value = currentLogoConfig.schoolName1;
                document.getElementById('schoolName2').value = currentLogoConfig.schoolName2;
                document.getElementById('primaryColor').value = currentLogoConfig.primaryColor;
                document.getElementById('secondaryColor').value = currentLogoConfig.secondaryColor;
                document.getElementById('logoSize').value = currentLogoConfig.logoSize;
                
                updateLogoConfig();
                alert('‚úÖ Logo berhasil direset ke default!');
            }
        }

        function downloadLogo() {
            try {
                const svgContent = generateLogoSVG(currentLogoConfig, 200);
                const svgBlob = new Blob([svgContent], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(svgBlob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `logo_${currentLogoConfig.schoolName1}_${currentLogoConfig.schoolName2}.svg`;
                a.click();
                
                URL.revokeObjectURL(url);
                
                logActivity('Admin mendownload logo sistem');
                alert('‚úÖ Logo SVG berhasil didownload!');
                
            } catch (e) {
                alert('‚ùå Gagal mendownload logo!');
            }
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('‚ùå Ukuran file terlalu besar! Maksimal 2MB.');
                return;
            }
            
            // Check file type
            const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/svg+xml'];
            if (!allowedTypes.includes(file.type)) {
                alert('‚ùå Format file tidak didukung! Gunakan PNG, JPG, atau SVG.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imageData = e.target.result;
                    
                    // Save custom image
                    currentLogoConfig.customImage = imageData;
                    
                    // Show preview
                    showCustomLogoPreview(imageData);
                    
                    // Update main previews
                    updateLogoConfig();
                    
                    logActivity('Admin mengupload logo custom');
                    
                } catch (error) {
                    alert('‚ùå Gagal memproses file logo!');
                }
            };
            
            reader.readAsDataURL(file);
        }

        function showCustomLogoPreview(imageData) {
            const previewDiv = document.getElementById('customLogoPreview');
            const imageDiv = document.getElementById('customLogoImage');
            
            imageDiv.innerHTML = `<img src="${imageData}" class="max-w-20 max-h-20 object-contain rounded border" alt="Custom Logo">`;
            previewDiv.classList.remove('hidden');
        }

        function removeCustomLogo() {
            if (confirm('üóëÔ∏è Hapus logo custom dan kembali ke logo default?')) {
                currentLogoConfig.customImage = null;
                
                // Hide preview
                document.getElementById('customLogoPreview').classList.add('hidden');
                
                // Reset file input
                document.getElementById('logoFileInput').value = '';
                
                // Update previews
                updateLogoConfig();
                
                logActivity('Admin menghapus logo custom');
                alert('‚úÖ Logo custom berhasil dihapus!');
            }
        }

        function backupData() {
            try {
                const data = {
                    accounts: accounts,
                    classes: classes,
                    subjects: subjects,
                    timePeriods: timePeriods,
                    students: students,
                    logoConfig: currentLogoConfig,
                    attendanceRecords: localStorage.getItem('all_attendance_records'),
                    systemLogs: localStorage.getItem('system_logs'),
                    backupDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup_sistem_absensi_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                URL.revokeObjectURL(url);
                
                logActivity('Admin melakukan backup data sistem');
                alert('‚úÖ Backup berhasil didownload!');
                
            } catch (e) {
                alert('‚ùå Gagal membuat backup!');
            }
        }

        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('‚ö†Ô∏è Restore akan mengganti semua data yang ada. Lanjutkan?')) {
                            // Restore data
                            if (data.accounts) Object.assign(accounts, data.accounts);
                            if (data.classes) classes.splice(0, classes.length, ...data.classes);
                            if (data.subjects) subjects.splice(0, subjects.length, ...data.subjects);
                            if (data.timePeriods) timePeriods.splice(0, timePeriods.length, ...data.timePeriods);
                            if (data.students) students.splice(0, students.length, ...data.students);
                            if (data.logoConfig) currentLogoConfig = data.logoConfig;
                            if (data.attendanceRecords) localStorage.setItem('all_attendance_records', data.attendanceRecords);
                            if (data.systemLogs) localStorage.setItem('system_logs', data.systemLogs);
                            
                            logActivity('Admin melakukan restore data sistem');
                            alert('‚úÖ Data berhasil direstore! Silakan refresh halaman.');
                        }
                    } catch (e) {
                        alert('‚ùå File backup tidak valid!');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearLogs() {
            if (confirm('‚ö†Ô∏è Hapus semua log aktivitas?')) {
                localStorage.removeItem('system_logs');
                populateSystemLogs();
                logActivity('Admin menghapus semua log sistem');
                alert('‚úÖ Log berhasil dihapus!');
            }
        }

        // View attendance detail function
        function viewAttendanceDetail(saveKey) {
            try {
                const attendanceData = localStorage.getItem(saveKey);
                if (!attendanceData) {
                    alert('‚ùå Data absensi tidak ditemukan!');
                    return;
                }
                
                const fullRecord = JSON.parse(attendanceData);
                const sectionsDiv = document.getElementById('teacherSections');
                
                sectionsDiv.innerHTML = `
                    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-800">üëÅÔ∏è Detail Absensi</h3>
                            <button onclick="showTeacherSection('history')" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                                ‚Üê Kembali ke Riwayat
                            </button>
                        </div>
                        
                        <!-- Session Info -->
                        <div class="bg-blue-50 p-6 rounded-lg mb-6 border border-blue-200">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div>
                                    <div class="text-blue-600 text-sm font-medium mb-1">üè´ Kelas</div>
                                    <div class="font-semibold text-gray-800">${fullRecord.class}</div>
                                </div>
                                <div>
                                    <div class="text-blue-600 text-sm font-medium mb-1">üìñ Mata Pelajaran</div>
                                    <div class="font-semibold text-gray-800">${fullRecord.subject}</div>
                                </div>
                                <div>
                                    <div class="text-blue-600 text-sm font-medium mb-1">üìÖ Tanggal</div>
                                    <div class="font-semibold text-gray-800">${fullRecord.date}</div>
                                </div>
                                <div>
                                    <div class="text-blue-600 text-sm font-medium mb-1">‚è∞ Jam Pelajaran</div>
                                    <div class="font-semibold text-gray-800">${fullRecord.time}</div>
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-blue-200">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-blue-700">üë®‚Äçüè´ Disimpan oleh: <strong>${fullRecord.savedBy}</strong></span>
                                    <span class="text-blue-700">üïí Waktu simpan: ${new Date(fullRecord.savedAt).toLocaleString('id-ID')}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Summary Stats -->
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200 text-center">
                                <div class="text-green-600 text-sm font-medium mb-2">‚úÖ Hadir</div>
                                <div class="text-3xl font-bold text-green-700">${fullRecord.summary.present}</div>
                                <div class="text-xs text-green-600 mt-1">${Math.round((fullRecord.summary.present / Object.values(fullRecord.summary).reduce((a,b) => a+b, 0)) * 100)}%</div>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 text-center">
                                <div class="text-yellow-600 text-sm font-medium mb-2">üìù Izin</div>
                                <div class="text-3xl font-bold text-yellow-700">${fullRecord.summary.excused}</div>
                                <div class="text-xs text-yellow-600 mt-1">${Math.round((fullRecord.summary.excused / Object.values(fullRecord.summary).reduce((a,b) => a+b, 0)) * 100)}%</div>
                            </div>
                            <div class="bg-orange-50 p-4 rounded-lg border border-orange-200 text-center">
                                <div class="text-orange-600 text-sm font-medium mb-2">ü§í Sakit</div>
                                <div class="text-3xl font-bold text-orange-700">${fullRecord.summary.sick}</div>
                                <div class="text-xs text-orange-600 mt-1">${Math.round((fullRecord.summary.sick / Object.values(fullRecord.summary).reduce((a,b) => a+b, 0)) * 100)}%</div>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200 text-center">
                                <div class="text-red-600 text-sm font-medium mb-2">‚ùå Alpha</div>
                                <div class="text-3xl font-bold text-red-700">${fullRecord.summary.absent}</div>
                                <div class="text-xs text-red-600 mt-1">${Math.round((fullRecord.summary.absent / Object.values(fullRecord.summary).reduce((a,b) => a+b, 0)) * 100)}%</div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 text-center">
                                <div class="text-purple-600 text-sm font-medium mb-2">üìã Dispensasi</div>
                                <div class="text-3xl font-bold text-purple-700">${fullRecord.summary.dispensasi}</div>
                                <div class="text-xs text-purple-600 mt-1">${Math.round((fullRecord.summary.dispensasi / Object.values(fullRecord.summary).reduce((a,b) => a+b, 0)) * 100)}%</div>
                            </div>
                        </div>
                        
                        <!-- Student List -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-4">üë• Daftar Kehadiran Siswa (${fullRecord.students.length} siswa)</h4>
                            
                            <!-- Filter Buttons -->
                            <div class="flex flex-wrap gap-2 mb-4">
                                <button onclick="filterDetailView('all')" class="px-3 py-1 bg-gray-500 text-white rounded-full text-sm hover:bg-gray-600 transition-colors" id="filter-all">
                                    Semua (${fullRecord.students.length})
                                </button>
                                <button onclick="filterDetailView('present')" class="px-3 py-1 bg-green-500 text-white rounded-full text-sm hover:bg-green-600 transition-colors" id="filter-present">
                                    Hadir (${fullRecord.summary.present})
                                </button>
                                <button onclick="filterDetailView('excused')" class="px-3 py-1 bg-yellow-500 text-white rounded-full text-sm hover:bg-yellow-600 transition-colors" id="filter-excused">
                                    Izin (${fullRecord.summary.excused})
                                </button>
                                <button onclick="filterDetailView('sick')" class="px-3 py-1 bg-orange-500 text-white rounded-full text-sm hover:bg-orange-600 transition-colors" id="filter-sick">
                                    Sakit (${fullRecord.summary.sick})
                                </button>
                                <button onclick="filterDetailView('absent')" class="px-3 py-1 bg-red-500 text-white rounded-full text-sm hover:bg-red-600 transition-colors" id="filter-absent">
                                    Alpha (${fullRecord.summary.absent})
                                </button>
                                <button onclick="filterDetailView('dispensasi')" class="px-3 py-1 bg-purple-500 text-white rounded-full text-sm hover:bg-purple-600 transition-colors" id="filter-dispensasi">
                                    Dispensasi (${fullRecord.summary.dispensasi})
                                </button>
                            </div>
                            
                            <div class="space-y-3 max-h-96 overflow-y-auto" id="studentDetailList">
                                ${fullRecord.students.map((student, index) => {
                                    const status = fullRecord.attendance[student.id] || 'present';
                                    const note = fullRecord.studentNotes[student.id] || '';
                                    
                                    const statusConfig = {
                                        'present': { text: 'Hadir', class: 'bg-green-100 text-green-800', icon: '‚úÖ' },
                                        'excused': { text: 'Izin', class: 'bg-yellow-100 text-yellow-800', icon: 'üìù' },
                                        'sick': { text: 'Sakit', class: 'bg-orange-100 text-orange-800', icon: 'ü§í' },
                                        'absent': { text: 'Alpha', class: 'bg-red-100 text-red-800', icon: '‚ùå' },
                                        'dispensasi': { text: 'Dispensasi', class: 'bg-purple-100 text-purple-800', icon: 'üìã' }
                                    };
                                    
                                    const config = statusConfig[status] || statusConfig['present'];
                                    
                                    return `
                                        <div class="bg-white p-4 rounded-lg border student-item" data-status="${status}">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center space-x-4">
                                                    <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center">
                                                        <span class="text-indigo-600 font-semibold">${student.name.charAt(0)}</span>
                                                    </div>
                                                    <div>
                                                        <div class="font-medium text-gray-800">${student.name}</div>
                                                        <div class="text-sm text-gray-500">NIS: ${student.nis}</div>
                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="flex items-center space-x-2 mb-2">
                                                        <span class="text-lg">${config.icon}</span>
                                                        <span class="px-3 py-1 rounded-full text-sm font-medium ${config.class}">
                                                            ${config.text}
                                                        </span>
                                                    </div>
                                                    ${note ? `
                                                        <div class="text-xs text-gray-600 bg-gray-50 px-2 py-1 rounded">
                                                            üìù ${note}
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="mt-6 flex flex-wrap gap-3 justify-center">
                            <button onclick="downloadSingleRecordExcel('${saveKey}')" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                üìä Download Excel
                            </button>
                            <button onclick="downloadSingleRecordPDF('${saveKey}')" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                üìÑ Download PDF
                            </button>
                            <button onclick="printAttendanceDetail()" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                üñ®Ô∏è Print
                            </button>
                            <button onclick="showTeacherSection('history')" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                ‚Üê Kembali
                            </button>
                        </div>
                    </div>
                `;
                
                // Store current record for other functions
                window.currentDetailRecord = fullRecord;
                
            } catch (e) {
                alert('‚ùå Terjadi kesalahan saat memuat detail absensi!');
                console.error('Error viewing attendance detail:', e);
            }
        }

        // Filter detail view function
        function filterDetailView(status) {
            const items = document.querySelectorAll('.student-item');
            const buttons = document.querySelectorAll('[id^="filter-"]');
            
            // Reset button styles
            buttons.forEach(btn => {
                btn.className = btn.className.replace('bg-gray-700', 'bg-gray-500');
            });
            
            // Highlight active button
            const activeButton = document.getElementById(`filter-${status}`);
            if (activeButton) {
                activeButton.className = activeButton.className.replace('bg-gray-500', 'bg-gray-700');
            }
            
            // Show/hide items
            items.forEach(item => {
                if (status === 'all' || item.dataset.status === status) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Download single record functions
        function downloadSingleRecordExcel(saveKey) {
            try {
                const attendanceData = localStorage.getItem(saveKey);
                if (!attendanceData) {
                    alert('‚ùå Data tidak ditemukan!');
                    return;
                }
                
                const record = JSON.parse(attendanceData);
                let csvContent = 'NIS,Nama Siswa,Status,Keterangan\n';
                
                record.students.forEach(student => {
                    const status = record.attendance[student.id] || 'present';
                    const note = record.studentNotes[student.id] || '';
                    const statusText = {
                        'present': 'Hadir',
                        'excused': 'Izin',
                        'sick': 'Sakit',
                        'absent': 'Alpha',
                        'dispensasi': 'Dispensasi'
                    }[status] || 'Hadir';
                    
                    csvContent += `"${student.nis}","${student.name}","${statusText}","${note}"\n`;
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `detail_absensi_${record.class}_${record.date.replace(/\//g, '-')}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('‚úÖ File Excel berhasil didownload!');
                
            } catch (e) {
                alert('‚ùå Gagal mendownload file Excel!');
            }
        }

        function downloadSingleRecordPDF(saveKey) {
            try {
                const attendanceData = localStorage.getItem(saveKey);
                if (!attendanceData) {
                    alert('‚ùå Data tidak ditemukan!');
                    return;
                }
                
                const record = JSON.parse(attendanceData);
                const totalStudents = Object.values(record.summary).reduce((a, b) => a + b, 0);
                const attendanceRate = totalStudents > 0 ? ((record.summary.present / totalStudents) * 100).toFixed(1) : 0;
                
                let htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Detail Absensi - ${record.class}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                            .info { margin-bottom: 20px; }
                            .info table { width: 100%; }
                            .info td { padding: 5px; }
                            table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; font-weight: bold; }
                            .summary { background-color: #f9f9f9; padding: 15px; margin: 20px 0; }
                            .footer { margin-top: 30px; text-align: right; font-size: 12px; color: #666; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>DETAIL ABSENSI SISWA</h1>
                            <h2>SMAN 5 Taruna Brawijaya Jawa Timur</h2>
                        </div>
                        
                        <div class="info">
                            <table>
                                <tr>
                                    <td><strong>Kelas:</strong></td>
                                    <td>${record.class}</td>
                                    <td><strong>Mata Pelajaran:</strong></td>
                                    <td>${record.subject}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tanggal:</strong></td>
                                    <td>${record.date}</td>
                                    <td><strong>Jam Pelajaran:</strong></td>
                                    <td>${record.time}</td>
                                </tr>
                                <tr>
                                    <td><strong>Guru:</strong></td>
                                    <td>${record.savedBy}</td>
                                    <td><strong>Tingkat Kehadiran:</strong></td>
                                    <td>${attendanceRate}%</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="summary">
                            <h3>RINGKASAN KEHADIRAN</h3>
                            <table>
                                <tr>
                                    <td><strong>Hadir:</strong></td>
                                    <td>${record.summary.present} siswa</td>
                                    <td><strong>Izin:</strong></td>
                                    <td>${record.summary.excused} siswa</td>
                                    <td><strong>Sakit:</strong></td>
                                    <td>${record.summary.sick} siswa</td>
                                </tr>
                                <tr>
                                    <td><strong>Alpha:</strong></td>
                                    <td>${record.summary.absent} siswa</td>
                                    <td><strong>Dispensasi:</strong></td>
                                    <td>${record.summary.dispensasi} siswa</td>
                                    <td><strong>Total:</strong></td>
                                    <td>${totalStudents} siswa</td>
                                </tr>
                            </table>
                        </div>
                        
                        <h3>DAFTAR KEHADIRAN SISWA</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>NIS</th>
                                    <th>Nama Siswa</th>
                                    <th>Status</th>
                                    <th>Keterangan</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                record.students.forEach((student, index) => {
                    const status = record.attendance[student.id] || 'present';
                    const note = record.studentNotes[student.id] || '';
                    const statusText = {
                        'present': 'Hadir',
                        'excused': 'Izin',
                        'sick': 'Sakit',
                        'absent': 'Alpha',
                        'dispensasi': 'Dispensasi'
                    }[status] || 'Hadir';
                    
                    htmlContent += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${student.nis}</td>
                            <td>${student.name}</td>
                            <td>${statusText}</td>
                            <td>${note}</td>
                        </tr>
                    `;
                });
                
                htmlContent += `
                            </tbody>
                        </table>
                        
                        <div class="footer">
                            <p>Dicetak pada: ${new Date().toLocaleString('id-ID')}</p>
                            <p>Sistem Absensi Digital SMAN 5 Taruna Brawijaya</p>
                        </div>
                    </body>
                    </html>
                `;
                
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `detail_absensi_${record.class}_${record.date.replace(/\//g, '-')}.html`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('‚úÖ File PDF berhasil didownload!\n\nüí° Buka file HTML dan gunakan Ctrl+P untuk mencetak ke PDF');
                
            } catch (e) {
                alert('‚ùå Gagal mendownload file PDF!');
            }
        }

        function printAttendanceDetail() {
            window.print();
        }

        // Utility functions
        function logActivity(activity) {
            try {
                let logs = [];
                const existingLogs = localStorage.getItem('system_logs');
                if (existingLogs) {
                    logs = JSON.parse(existingLogs);
                }
                
                logs.push({
                    activity: activity,
                    timestamp: new Date().toLocaleString('id-ID'),
                    user: currentUser ? currentUser.name : 'System'
                });
                
                // Keep only last 100 logs
                if (logs.length > 100) {
                    logs = logs.slice(-100);
                }
                
                localStorage.setItem('system_logs', JSON.stringify(logs));
            } catch (e) {
                console.error('Failed to log activity:', e);
            }
        }

        function logout() {
            if (confirm('üö™ Yakin ingin logout?')) {
                logActivity(`${currentUser.name} logout dari sistem`);
                
                currentUser = null;
                currentRole = null;
                
                // Hide all dashboards
                document.getElementById('adminDashboard').classList.add('hidden');
                document.getElementById('teacherDashboard').classList.add('hidden');
                
                // Show login screen
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Clear form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('userRole').value = 'admin';
            }
        }

        // Teacher download functions
        function updateTeacherDownloadStats() {
            try {
                const allRecords = localStorage.getItem('all_attendance_records');
                if (allRecords) {
                    const records = JSON.parse(allRecords);
                    const myRecords = records.filter(record => record.savedBy === currentUser.name);
                    
                    // Total records
                    document.getElementById('teacherTotalRecords').textContent = myRecords.length;
                    
                    // Unique classes
                    const uniqueClasses = [...new Set(myRecords.map(record => record.class))];
                    document.getElementById('teacherTotalClasses').textContent = uniqueClasses.length;
                    
                    // Total students (approximate)
                    const totalStudents = myRecords.reduce((sum, record) => {
                        return sum + Object.values(record.summary).reduce((a, b) => a + b, 0);
                    }, 0);
                    document.getElementById('teacherTotalStudents').textContent = Math.round(totalStudents / Math.max(myRecords.length, 1));
                    
                    // Average attendance
                    const totalPresent = myRecords.reduce((sum, record) => sum + record.summary.present, 0);
                    const avgAttendance = totalStudents > 0 ? Math.round((totalPresent / totalStudents) * 100) : 0;
                    document.getElementById('teacherAvgAttendance').textContent = avgAttendance + '%';
                } else {
                    document.getElementById('teacherTotalRecords').textContent = '0';
                    document.getElementById('teacherTotalClasses').textContent = '0';
                    document.getElementById('teacherTotalStudents').textContent = '0';
                    document.getElementById('teacherAvgAttendance').textContent = '0%';
                }
            } catch (e) {
                console.error('Error updating stats:', e);
            }
        }

        function getFilteredTeacherRecords() {
            try {
                const allRecords = localStorage.getItem('all_attendance_records');
                if (!allRecords) return [];
                
                let records = JSON.parse(allRecords);
                
                // Filter by teacher
                records = records.filter(record => record.savedBy === currentUser.name);
                
                // Filter by class if selected
                const classFilter = document.getElementById('downloadClassFilter')?.value;
                if (classFilter) {
                    records = records.filter(record => record.class === classFilter);
                }
                
                // Filter by subject if selected
                const subjectFilter = document.getElementById('downloadSubjectFilter')?.value;
                if (subjectFilter) {
                    records = records.filter(record => record.subject === subjectFilter);
                }
                
                // Filter by date range
                const dateFrom = document.getElementById('downloadDateFrom')?.value;
                const dateTo = document.getElementById('downloadDateTo')?.value;
                
                if (dateFrom || dateTo) {
                    records = records.filter(record => {
                        const recordDate = new Date(record.date.split('/').reverse().join('-'));
                        const fromDate = dateFrom ? new Date(dateFrom) : new Date('1900-01-01');
                        const toDate = dateTo ? new Date(dateTo) : new Date('2100-12-31');
                        return recordDate >= fromDate && recordDate <= toDate;
                    });
                }
                
                return records.sort((a, b) => new Date(b.date.split('/').reverse().join('-')) - new Date(a.date.split('/').reverse().join('-')));
            } catch (e) {
                console.error('Error filtering records:', e);
                return [];
            }
        }

        function previewDownloadData() {
            const records = getFilteredTeacherRecords();
            const previewDiv = document.getElementById('downloadPreview');
            const contentDiv = document.getElementById('downloadPreviewContent');
            
            if (records.length === 0) {
                contentDiv.innerHTML = '<p class="text-gray-500 text-center py-4">Tidak ada data sesuai filter yang dipilih</p>';
                previewDiv.classList.remove('hidden');
                return;
            }
            
            // Calculate totals
            let totalPresent = 0, totalExcused = 0, totalSick = 0, totalAbsent = 0, totalDispensasi = 0;
            records.forEach(record => {
                totalPresent += record.summary.present || 0;
                totalExcused += record.summary.excused || 0;
                totalSick += record.summary.sick || 0;
                totalAbsent += record.summary.absent || 0;
                totalDispensasi += record.summary.dispensasi || 0;
            });
            
            const grandTotal = totalPresent + totalExcused + totalSick + totalAbsent + totalDispensasi;
            
            const previewHTML = `
                <div class="space-y-4">
                    <!-- Summary Header -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-semibold text-blue-800">üìä Ringkasan Data Preview</span>
                            <span class="text-sm text-blue-600">Total: ${records.length} sesi absensi</span>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-6 gap-3 text-center">
                            <div class="bg-white p-2 rounded border">
                                <div class="text-xs text-gray-600">Total Siswa</div>
                                <div class="font-bold text-gray-800">${grandTotal}</div>
                            </div>
                            <div class="bg-green-50 p-2 rounded border border-green-200">
                                <div class="text-xs text-green-600">Hadir</div>
                                <div class="font-bold text-green-700">${totalPresent}</div>
                            </div>
                            <div class="bg-yellow-50 p-2 rounded border border-yellow-200">
                                <div class="text-xs text-yellow-600">Izin</div>
                                <div class="font-bold text-yellow-700">${totalExcused}</div>
                            </div>
                            <div class="bg-orange-50 p-2 rounded border border-orange-200">
                                <div class="text-xs text-orange-600">Sakit</div>
                                <div class="font-bold text-orange-700">${totalSick}</div>
                            </div>
                            <div class="bg-red-50 p-2 rounded border border-red-200">
                                <div class="text-xs text-red-600">Alpha</div>
                                <div class="font-bold text-red-700">${totalAbsent}</div>
                            </div>
                            <div class="bg-purple-50 p-2 rounded border border-purple-200">
                                <div class="text-xs text-purple-600">Dispensasi</div>
                                <div class="font-bold text-purple-700">${totalDispensasi}</div>
                            </div>
                        </div>
                        <div class="mt-3 text-center">
                            <span class="text-sm text-blue-700">
                                üìÖ Periode: ${records.length > 0 ? records[records.length-1]?.date : ''} - ${records.length > 0 ? records[0]?.date : ''}
                            </span>
                        </div>
                    </div>
                    
                    <!-- Records List -->
                    <div class="space-y-2">
                        <h5 class="font-medium text-gray-800">üìã Detail Sesi Absensi (${Math.min(records.length, 10)} dari ${records.length})</h5>
                        ${records.slice(0, 10).map((record, index) => {
                            const sessionTotal = Object.values(record.summary).reduce((a, b) => a + b, 0);
                            const attendanceRate = sessionTotal > 0 ? Math.round((record.summary.present / sessionTotal) * 100) : 0;
                            
                            return `
                                <div class="bg-white p-3 rounded border hover:bg-gray-50 transition-colors">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center space-x-2">
                                                <span class="text-sm font-medium text-gray-500">#${index + 1}</span>
                                                <span class="font-medium text-gray-800">${record.class}</span>
                                                <span class="text-gray-400">‚Ä¢</span>
                                                <span class="text-gray-700">${record.subject}</span>
                                            </div>
                                            <div class="text-sm text-gray-600 mt-1">
                                                üìÖ ${record.date} ‚Ä¢ ‚è∞ ${record.time}
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="flex items-center space-x-3 text-sm">
                                                <span class="text-green-600 font-medium">‚úì ${record.summary.present}</span>
                                                <span class="text-yellow-600">üìù ${record.summary.excused}</span>
                                                <span class="text-orange-600">ü§í ${record.summary.sick}</span>
                                                <span class="text-red-600">‚ùå ${record.summary.absent}</span>
                                                <span class="text-purple-600">üìã ${record.summary.dispensasi}</span>
                                            </div>
                                            <div class="text-xs text-gray-500 mt-1">
                                                Total: ${sessionTotal} siswa ‚Ä¢ Kehadiran: ${attendanceRate}%
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                        ${records.length > 10 ? `
                            <div class="text-center text-sm text-gray-500 py-3 bg-gray-50 rounded border border-dashed">
                                ... dan ${records.length - 10} sesi absensi lainnya
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Download Ready Notice -->
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <div class="flex items-center space-x-2">
                            <span class="text-green-600">‚úÖ</span>
                            <span class="font-medium text-green-800">Data siap untuk didownload!</span>
                        </div>
                        <p class="text-sm text-green-700 mt-1">
                            Gunakan tombol download di bawah untuk mengexport data dalam format Excel atau PDF.
                        </p>
                    </div>
                </div>
            `;
            
            contentDiv.innerHTML = previewHTML;
            previewDiv.classList.remove('hidden');
        }

        function downloadTeacherExcel(type) {
            const records = getFilteredTeacherRecords();
            
            if (records.length === 0) {
                alert('‚ùå Tidak ada data untuk didownload!\n\nSilakan pilih filter yang sesuai atau pastikan Anda sudah membuat absensi.');
                return;
            }
            
            let csvContent = '';
            
            if (type === 'summary') {
                // Summary format
                csvContent = 'Tanggal,Kelas,Mata Pelajaran,Jam,Hadir,Izin,Sakit,Alpha,Dispensasi,Total\n';
                
                records.forEach(record => {
                    const total = Object.values(record.summary).reduce((a, b) => a + b, 0);
                    csvContent += `"${record.date}","${record.class}","${record.subject}","${record.time}",${record.summary.present},${record.summary.excused},${record.summary.sick},${record.summary.absent},${record.summary.dispensasi},${total}\n`;
                });
            } else {
                // Detailed format
                csvContent = 'Tanggal,Kelas,Mata Pelajaran,Jam,NIS,Nama Siswa,Status,Keterangan\n';
                
                records.forEach(record => {
                    // Get detailed attendance data
                    const attendanceData = localStorage.getItem(record.saveKey);
                    if (attendanceData) {
                        const fullRecord = JSON.parse(attendanceData);
                        fullRecord.students.forEach(student => {
                            const status = fullRecord.attendance[student.id] || 'present';
                            const note = fullRecord.studentNotes[student.id] || '';
                            const statusText = {
                                'present': 'Hadir',
                                'excused': 'Izin',
                                'sick': 'Sakit',
                                'absent': 'Alpha',
                                'dispensasi': 'Dispensasi'
                            }[status] || 'Hadir';
                            
                            csvContent += `"${record.date}","${record.class}","${record.subject}","${record.time}","${student.nis}","${student.name}","${statusText}","${note}"\n`;
                        });
                    }
                });
            }
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `absensi_${type}_${currentUser.username}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            logActivity(`${currentUser.name} mendownload laporan Excel ${type}`);
            alert(`‚úÖ File Excel ${type === 'summary' ? 'Ringkasan' : 'Detail'} berhasil didownload!\n\nüìÅ File: absensi_${type}_${currentUser.username}_${new Date().toISOString().split('T')[0]}.csv`);
        }

        function downloadTeacherPDF(type) {
            const records = getFilteredTeacherRecords();
            
            if (records.length === 0) {
                alert('‚ùå Tidak ada data untuk didownload!\n\nSilakan pilih filter yang sesuai atau pastikan Anda sudah membuat absensi.');
                return;
            }
            
            // Create HTML content for PDF
            let htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Laporan Absensi - ${currentUser.name}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                        .info { margin-bottom: 20px; }
                        .info table { width: 100%; }
                        .info td { padding: 5px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .summary { background-color: #f9f9f9; padding: 15px; margin: 20px 0; }
                        .footer { margin-top: 30px; text-align: right; font-size: 12px; color: #666; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>LAPORAN ABSENSI SISWA</h1>
                        <h2>SMAN 5 Taruna Brawijaya Jawa Timur</h2>
                        <p>Sistem Absensi Digital</p>
                    </div>
                    
                    <div class="info">
                        <table>
                            <tr>
                                <td><strong>Guru:</strong></td>
                                <td>${currentUser.name}</td>
                                <td><strong>Tanggal Cetak:</strong></td>
                                <td>${new Date().toLocaleDateString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td><strong>Periode:</strong></td>
                                <td>${records[records.length-1]?.date} - ${records[0]?.date}</td>
                                <td><strong>Total Record:</strong></td>
                                <td>${records.length} absensi</td>
                            </tr>
                        </table>
                    </div>
            `;
            
            if (type === 'summary') {
                htmlContent += `
                    <h3>üìä RINGKASAN ABSENSI</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Kelas</th>
                                <th>Mata Pelajaran</th>
                                <th>Jam</th>
                                <th>Hadir</th>
                                <th>Izin</th>
                                <th>Sakit</th>
                                <th>Alpha</th>
                                <th>Dispensasi</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                records.forEach((record, index) => {
                    const total = Object.values(record.summary).reduce((a, b) => a + b, 0);
                    htmlContent += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${record.date}</td>
                            <td>${record.class}</td>
                            <td>${record.subject}</td>
                            <td>${record.time}</td>
                            <td>${record.summary.present}</td>
                            <td>${record.summary.excused}</td>
                            <td>${record.summary.sick}</td>
                            <td>${record.summary.absent}</td>
                            <td>${record.summary.dispensasi}</td>
                            <td>${total}</td>
                        </tr>
                    `;
                });
                
                htmlContent += '</tbody></table>';
            } else {
                htmlContent += `<h3>üìã DETAIL ABSENSI SISWA</h3>`;
                
                records.forEach((record, recordIndex) => {
                    htmlContent += `
                        <h4>Absensi ${recordIndex + 1}: ${record.class} - ${record.subject} (${record.date})</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>NIS</th>
                                    <th>Nama Siswa</th>
                                    <th>Status</th>
                                    <th>Keterangan</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    // Get detailed attendance data
                    const attendanceData = localStorage.getItem(record.saveKey);
                    if (attendanceData) {
                        const fullRecord = JSON.parse(attendanceData);
                        fullRecord.students.forEach((student, studentIndex) => {
                            const status = fullRecord.attendance[student.id] || 'present';
                            const note = fullRecord.studentNotes[student.id] || '';
                            const statusText = {
                                'present': 'Hadir',
                                'excused': 'Izin',
                                'sick': 'Sakit',
                                'absent': 'Alpha',
                                'dispensasi': 'Dispensasi'
                            }[status] || 'Hadir';
                            
                            htmlContent += `
                                <tr>
                                    <td>${studentIndex + 1}</td>
                                    <td>${student.nis}</td>
                                    <td>${student.name}</td>
                                    <td>${statusText}</td>
                                    <td>${note}</td>
                                </tr>
                            `;
                        });
                    }
                    
                    htmlContent += '</tbody></table>';
                });
            }
            
            // Add summary statistics
            const totalRecords = records.length;
            const totalPresent = records.reduce((sum, record) => sum + record.summary.present, 0);
            const totalStudents = records.reduce((sum, record) => sum + Object.values(record.summary).reduce((a, b) => a + b, 0), 0);
            const avgAttendance = totalStudents > 0 ? ((totalPresent / totalStudents) * 100).toFixed(1) : 0;
            
            htmlContent += `
                <div class="summary">
                    <h3>üìà STATISTIK KESELURUHAN</h3>
                    <table>
                        <tr>
                            <td><strong>Total Sesi Absensi:</strong></td>
                            <td>${totalRecords} sesi</td>
                            <td><strong>Total Kehadiran:</strong></td>
                            <td>${totalPresent} siswa</td>
                        </tr>
                        <tr>
                            <td><strong>Total Siswa (Kumulatif):</strong></td>
                            <td>${totalStudents} siswa</td>
                            <td><strong>Rata-rata Kehadiran:</strong></td>
                            <td>${avgAttendance}%</td>
                        </tr>
                    </table>
                </div>
                
                <div class="footer">
                    <p>Laporan ini digenerate otomatis oleh Sistem Absensi Digital SMAN 5 Taruna Brawijaya</p>
                    <p>Dicetak pada: ${new Date().toLocaleString('id-ID')}</p>
                </div>
                
                </body>
                </html>
            `;
            
            // Create and download PDF (as HTML file that can be printed to PDF)
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `laporan_absensi_${type}_${currentUser.username}_${new Date().toISOString().split('T')[0]}.html`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            logActivity(`${currentUser.name} mendownload laporan PDF ${type}`);
            alert(`‚úÖ File PDF ${type === 'summary' ? 'Ringkasan' : 'Detail'} berhasil didownload!\n\nüìÅ File: laporan_absensi_${type}_${currentUser.username}_${new Date().toISOString().split('T')[0]}.html\n\nüí° Buka file HTML dan gunakan Ctrl+P untuk mencetak ke PDF`);
        }

        function quickDownload(period) {
            const today = new Date();
            let dateFrom, dateTo;
            
            if (period === 'today') {
                dateFrom = dateTo = today.toISOString().split('T')[0];
            } else if (period === 'week') {
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay());
                dateFrom = weekStart.toISOString().split('T')[0];
                dateTo = today.toISOString().split('T')[0];
            } else if (period === 'month') {
                dateFrom = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
                dateTo = today.toISOString().split('T')[0];
            }
            
            // Set the date filters
            if (document.getElementById('downloadDateFrom')) {
                document.getElementById('downloadDateFrom').value = dateFrom;
            }
            if (document.getElementById('downloadDateTo')) {
                document.getElementById('downloadDateTo').value = dateTo;
            }
            
            // Clear class and subject filters for quick download
            if (document.getElementById('downloadClassFilter')) {
                document.getElementById('downloadClassFilter').value = '';
            }
            if (document.getElementById('downloadSubjectFilter')) {
                document.getElementById('downloadSubjectFilter').value = '';
            }
            
            // Preview and download
            previewDownloadData();
            
            // Auto download summary Excel
            setTimeout(() => {
                downloadTeacherExcel('summary');
            }, 500);
        }

        // Journal functions
        function saveJournalEntry() {
            try {
                // Get form values
                const journalData = {
                    id: Date.now(),
                    class: document.getElementById('journalClass').value,
                    subject: document.getElementById('journalSubject').value,
                    date: document.getElementById('journalDate').value,
                    time: document.getElementById('journalTime').value,
                    meeting: parseInt(document.getElementById('journalMeeting').value),
                    theme: document.getElementById('journalTheme').value.trim(),
                    kd: document.getElementById('journalKD').value.trim(),
                    activity: document.getElementById('journalActivity').value.trim(),
                    method: document.getElementById('journalMethod').value,
                    media: document.getElementById('journalMedia').value.trim(),
                    notes: document.getElementById('journalNotes').value.trim(),
                    teacher: currentUser.name,
                    createdAt: new Date().toISOString()
                };
                
                // Validate required fields
                if (!journalData.theme) {
                    alert('‚ùå Tema/Materi Pembelajaran harus diisi!');
                    document.getElementById('journalTheme').focus();
                    return;
                }
                
                if (!journalData.activity) {
                    alert('‚ùå Kegiatan Pembelajaran harus diisi!');
                    document.getElementById('journalActivity').focus();
                    return;
                }
                
                // Save to localStorage
                let journals = [];
                try {
                    const existingJournals = localStorage.getItem('teaching_journals');
                    if (existingJournals) {
                        journals = JSON.parse(existingJournals);
                    }
                } catch (e) {
                    journals = [];
                }
                
                journals.push(journalData);
                
                // Keep only last 200 entries
                if (journals.length > 200) {
                    journals = journals.slice(-200);
                }
                
                localStorage.setItem('teaching_journals', JSON.stringify(journals));
                
                // Log activity
                logActivity(`${currentUser.name} menambah jurnal mengajar: ${journalData.class} - ${journalData.subject} (Pertemuan ${journalData.meeting})`);
                
                // Clear form
                document.getElementById('journalTheme').value = '';
                document.getElementById('journalKD').value = '';
                document.getElementById('journalActivity').value = '';
                document.getElementById('journalMedia').value = '';
                document.getElementById('journalNotes').value = '';
                document.getElementById('journalMeeting').value = '1';
                
                // Refresh journal history
                populateJournalHistory();
                
                // Show success message
                alert(`‚úÖ Jurnal mengajar berhasil disimpan!\n\nüìã Detail:\n‚Ä¢ Kelas: ${journalData.class}\n‚Ä¢ Mata Pelajaran: ${journalData.subject}\n‚Ä¢ Pertemuan: ${journalData.meeting}\n‚Ä¢ Tema: ${journalData.theme}`);
                
            } catch (error) {
                console.error('Save journal error:', error);
                alert('‚ùå Terjadi kesalahan saat menyimpan jurnal mengajar.\n\nSilakan coba lagi.');
            }
        }

        function populateJournalHistory() {
            const container = document.getElementById('journalHistory');
            
            try {
                const journals = localStorage.getItem('teaching_journals');
                if (journals) {
                    const journalEntries = JSON.parse(journals);
                    const myJournals = journalEntries.filter(journal => journal.teacher === currentUser.name);
                    
                    if (myJournals.length === 0) {
                        container.innerHTML = `
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">üìñ</div>
                                <h3 class="text-lg font-medium text-gray-800 mb-2">Belum Ada Jurnal Mengajar</h3>
                                <p class="text-gray-600 mb-6">Anda belum pernah membuat jurnal mengajar. Mulai buat jurnal pertama Anda!</p>
                                <div class="text-sm text-blue-600 bg-blue-50 p-3 rounded-lg inline-block">
                                    üí° Jurnal mengajar membantu Anda melacak progress pembelajaran dan pertemuan
                                </div>
                            </div>
                        `;
                        return;
                    }
                    
                    // Sort journals by date (newest first)
                    myJournals.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    // Group by class and subject
                    const groupedJournals = {};
                    myJournals.forEach(journal => {
                        const key = `${journal.class} - ${journal.subject}`;
                        if (!groupedJournals[key]) {
                            groupedJournals[key] = [];
                        }
                        groupedJournals[key].push(journal);
                    });
                    
                    container.innerHTML = `
                        <div class="space-y-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-semibold text-gray-800">üìö Riwayat Jurnal Mengajar (${myJournals.length} jurnal)</h4>
                                <div class="flex space-x-2">
                                    <button onclick="downloadJournalReport()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm">
                                        üì• Download Laporan
                                    </button>
                                    <button onclick="printJournalReport()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm">
                                        üñ®Ô∏è Print
                                    </button>
                                </div>
                            </div>
                            
                            ${Object.keys(groupedJournals).map(classSubject => {
                                const journals = groupedJournals[classSubject];
                                const totalMeetings = journals.length;
                                const latestMeeting = Math.max(...journals.map(j => j.meeting));
                                
                                return `
                                    <div class="bg-white rounded-xl shadow-lg border hover:shadow-xl transition-shadow">
                                        <div class="p-6">
                                            <div class="flex items-center justify-between mb-4">
                                                <div>
                                                    <h5 class="text-xl font-semibold text-gray-800">${classSubject}</h5>
                                                    <div class="flex items-center space-x-4 text-sm text-gray-600 mt-1">
                                                        <span class="flex items-center space-x-1">
                                                            <span>üìä</span>
                                                            <span>${totalMeetings} jurnal tersimpan</span>
                                                        </span>
                                                        <span class="flex items-center space-x-1">
                                                            <span>üéØ</span>
                                                            <span>Pertemuan terakhir: ${latestMeeting}</span>
                                                        </span>
                                                        <span class="flex items-center space-x-1">
                                                            <span>üìÖ</span>
                                                            <span>Update: ${new Date(journals[0].date).toLocaleDateString('id-ID')}</span>
                                                        </span>
                                                    </div>
                                                </div>
                                                <button onclick="toggleJournalDetails('${classSubject.replace(/\s+/g, '_')}')" class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 text-sm">
                                                    üëÅÔ∏è Lihat Detail
                                                </button>
                                            </div>
                                            
                                            <div id="details_${classSubject.replace(/\s+/g, '_')}" class="hidden">
                                                <div class="border-t pt-4">
                                                    <div class="space-y-4 max-h-96 overflow-y-auto">
                                                        ${journals.map((journal, index) => `
                                                            <div class="bg-gray-50 p-4 rounded-lg border">
                                                                <div class="flex items-start justify-between mb-3">
                                                                    <div class="flex-1">
                                                                        <div class="flex items-center space-x-3 mb-2">
                                                                            <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                                                                                Pertemuan ${journal.meeting}
                                                                            </span>
                                                                            <span class="text-gray-600">üìÖ ${new Date(journal.date).toLocaleDateString('id-ID')}</span>
                                                                            <span class="text-gray-600">‚è∞ ${journal.time}</span>
                                                                        </div>
                                                                        <h6 class="font-semibold text-gray-800 mb-2">üìñ ${journal.theme}</h6>
                                                                        ${journal.kd ? `<p class="text-sm text-gray-600 mb-2"><strong>KD:</strong> ${journal.kd}</p>` : ''}
                                                                    </div>
                                                                    <button onclick="viewJournalDetail(${journal.id})" class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">
                                                                        üìã Detail
                                                                    </button>
                                                                </div>
                                                                
                                                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                                                    <div>
                                                                        <div class="text-gray-600 mb-1"><strong>Kegiatan:</strong></div>
                                                                        <div class="text-gray-800 bg-white p-2 rounded border">
                                                                            ${journal.activity.length > 100 ? journal.activity.substring(0, 100) + '...' : journal.activity}
                                                                        </div>
                                                                    </div>
                                                                    <div>
                                                                        <div class="text-gray-600 mb-1"><strong>Metode & Media:</strong></div>
                                                                        <div class="text-gray-800 bg-white p-2 rounded border">
                                                                            <div><strong>Metode:</strong> ${journal.method}</div>
                                                                            ${journal.media ? `<div><strong>Media:</strong> ${journal.media}</div>` : ''}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                ${journal.notes ? `
                                                                    <div class="mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded">
                                                                        <div class="text-sm text-yellow-800">
                                                                            <strong>üìù Catatan:</strong> ${journal.notes}
                                                                        </div>
                                                                    </div>
                                                                ` : ''}
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">üìñ</div>
                            <h3 class="text-lg font-medium text-gray-800 mb-2">Belum Ada Data Jurnal</h3>
                            <p class="text-gray-600 mb-6">Sistem belum memiliki data jurnal mengajar tersimpan.</p>
                            <div class="text-sm text-blue-600 bg-blue-50 p-3 rounded-lg inline-block">
                                üí° Mulai buat jurnal mengajar untuk melacak progress pembelajaran Anda
                            </div>
                        </div>
                    `;
                }
            } catch (e) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">‚ùå</div>
                        <h3 class="text-lg font-medium text-red-800 mb-2">Error Memuat Data</h3>
                        <p class="text-red-600 mb-6">Terjadi kesalahan saat memuat riwayat jurnal mengajar.</p>
                        <button onclick="populateJournalHistory()" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            üîÑ Coba Lagi
                        </button>
                    </div>
                `;
            }
        }

        function toggleJournalDetails(classSubjectId) {
            const detailsDiv = document.getElementById(`details_${classSubjectId}`);
            if (detailsDiv.classList.contains('hidden')) {
                detailsDiv.classList.remove('hidden');
            } else {
                detailsDiv.classList.add('hidden');
            }
        }

        function viewJournalDetail(journalId) {
            try {
                const journals = localStorage.getItem('teaching_journals');
                if (!journals) {
                    alert('‚ùå Data jurnal tidak ditemukan!');
                    return;
                }
                
                const journalEntries = JSON.parse(journals);
                const journal = journalEntries.find(j => j.id === journalId);
                
                if (!journal) {
                    alert('‚ùå Jurnal tidak ditemukan!');
                    return;
                }
                
                const detailHTML = `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                            <div class="p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-semibold text-gray-800">üìã Detail Jurnal Mengajar</h3>
                                    <button onclick="closeJournalDetail()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                                        ‚úï Tutup
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                    <div class="space-y-4">
                                        <div class="bg-blue-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-blue-800 mb-3">üìö Informasi Pembelajaran</h4>
                                            <div class="space-y-2 text-sm">
                                                <div><strong>Kelas:</strong> ${journal.class}</div>
                                                <div><strong>Mata Pelajaran:</strong> ${journal.subject}</div>
                                                <div><strong>Tanggal:</strong> ${new Date(journal.date).toLocaleDateString('id-ID')}</div>
                                                <div><strong>Jam Pelajaran:</strong> ${journal.time}</div>
                                                <div><strong>Pertemuan Ke:</strong> ${journal.meeting}</div>
                                                <div><strong>Guru:</strong> ${journal.teacher}</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-green-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-green-800 mb-3">üéØ Kompetensi & Tema</h4>
                                            <div class="space-y-2 text-sm">
                                                <div><strong>Tema/Materi:</strong></div>
                                                <div class="bg-white p-2 rounded border">${journal.theme}</div>
                                                ${journal.kd ? `
                                                    <div><strong>Kompetensi Dasar:</strong></div>
                                                    <div class="bg-white p-2 rounded border">${journal.kd}</div>
                                                ` : ''}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-4">
                                        <div class="bg-purple-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-purple-800 mb-3">üéì Metode & Media</h4>
                                            <div class="space-y-2 text-sm">
                                                <div><strong>Metode Pembelajaran:</strong></div>
                                                <div class="bg-white p-2 rounded border">${journal.method}</div>
                                                ${journal.media ? `
                                                    <div><strong>Media Pembelajaran:</strong></div>
                                                    <div class="bg-white p-2 rounded border">${journal.media}</div>
                                                ` : ''}
                                            </div>
                                        </div>
                                        
                                        ${journal.notes ? `
                                            <div class="bg-yellow-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-yellow-800 mb-3">üìù Catatan & Refleksi</h4>
                                                <div class="bg-white p-2 rounded border text-sm">${journal.notes}</div>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-gray-800 mb-3">üìñ Kegiatan Pembelajaran</h4>
                                    <div class="bg-white p-4 rounded border text-sm whitespace-pre-wrap">${journal.activity}</div>
                                </div>
                                
                                <div class="mt-6 flex gap-3 justify-center">
                                    <button onclick="downloadSingleJournal(${journal.id})" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                        üì• Download PDF
                                    </button>
                                    <button onclick="printSingleJournal(${journal.id})" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                        üñ®Ô∏è Print
                                    </button>
                                    <button onclick="editJournal(${journal.id})" class="px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600">
                                        ‚úèÔ∏è Edit
                                    </button>
                                    <button onclick="deleteJournal(${journal.id})" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                        üóëÔ∏è Hapus
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', detailHTML);
                
            } catch (e) {
                alert('‚ùå Terjadi kesalahan saat memuat detail jurnal!');
                console.error('Error viewing journal detail:', e);
            }
        }

        function closeJournalDetail() {
            const modal = document.querySelector('.fixed.inset-0.bg-black');
            if (modal) {
                modal.remove();
            }
        }

        function downloadJournalReport() {
            try {
                const journals = localStorage.getItem('teaching_journals');
                if (!journals) {
                    alert('‚ùå Tidak ada data jurnal untuk didownload!');
                    return;
                }
                
                const journalEntries = JSON.parse(journals);
                const myJournals = journalEntries.filter(journal => journal.teacher === currentUser.name);
                
                if (myJournals.length === 0) {
                    alert('‚ùå Anda belum memiliki jurnal mengajar!');
                    return;
                }
                
                // Sort by date
                myJournals.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                let csvContent = 'Tanggal,Kelas,Mata Pelajaran,Jam,Pertemuan,Tema/Materi,Kompetensi Dasar,Kegiatan Pembelajaran,Metode,Media,Catatan\n';
                
                myJournals.forEach(journal => {
                    const row = [
                        journal.date,
                        journal.class,
                        journal.subject,
                        journal.time,
                        journal.meeting,
                        `"${journal.theme.replace(/"/g, '""')}"`,
                        `"${(journal.kd || '').replace(/"/g, '""')}"`,
                        `"${journal.activity.replace(/"/g, '""')}"`,
                        journal.method,
                        `"${(journal.media || '').replace(/"/g, '""')}"`,
                        `"${(journal.notes || '').replace(/"/g, '""')}"`
                    ];
                    csvContent += row.join(',') + '\n';
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `jurnal_mengajar_${currentUser.username}_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                logActivity(`${currentUser.name} mendownload laporan jurnal mengajar`);
                alert('‚úÖ Laporan jurnal mengajar berhasil didownload!');
                
            } catch (e) {
                alert('‚ùå Gagal mendownload laporan jurnal!');
            }
        }

        function deleteJournal(journalId) {
            if (confirm('‚ö†Ô∏è Yakin ingin menghapus jurnal ini?\n\nData yang dihapus tidak dapat dikembalikan.')) {
                try {
                    const journals = localStorage.getItem('teaching_journals');
                    if (journals) {
                        let journalEntries = JSON.parse(journals);
                        const journalIndex = journalEntries.findIndex(j => j.id === journalId);
                        
                        if (journalIndex > -1) {
                            const deletedJournal = journalEntries[journalIndex];
                            journalEntries.splice(journalIndex, 1);
                            localStorage.setItem('teaching_journals', JSON.stringify(journalEntries));
                            
                            logActivity(`${currentUser.name} menghapus jurnal mengajar: ${deletedJournal.class} - ${deletedJournal.subject} (Pertemuan ${deletedJournal.meeting})`);
                            
                            closeJournalDetail();
                            populateJournalHistory();
                            
                            alert('‚úÖ Jurnal berhasil dihapus!');
                        }
                    }
                } catch (e) {
                    alert('‚ùå Gagal menghapus jurnal!');
                }
            }
        }

        // Initialize the application
        function initializeApp() {
            // Load saved logo config
            try {
                const savedConfig = localStorage.getItem('logo_config');
                if (savedConfig) {
                    currentLogoConfig = { ...currentLogoConfig, ...JSON.parse(savedConfig) };
                }
            } catch (e) {
                console.log('No saved logo config found, using defaults');
            }
            
            // Update login logo
            document.getElementById('loginLogo').innerHTML = generateLogoSVG(currentLogoConfig, 100);
            
            // Focus on username field
            document.getElementById('username').focus();
        }

        // Start the application
        initializeApp();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97b71b128629fde7',t:'MTc1NzI1NzU0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
